================================================================================
                    KUBERNETES SERVICES
                    Chapter 4: Service Discovery and Load Balancing
================================================================================

Services provide stable networking for ephemeral Pods. This chapter
covers service types, discovery, and load balancing.


================================================================================
SECTION 4.1: WHY SERVICES?
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE PROBLEM                                                           â”‚
    â”‚                                                                         â”‚
    â”‚  Pods are ephemeral:                                                   â”‚
    â”‚  â€¢ IPs change when pods restart                                      â”‚
    â”‚  â€¢ Multiple replicas have different IPs                              â”‚
    â”‚  â€¢ Pods can be created/destroyed at any time                        â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Before restart:           After restart:                     â”‚  â”‚
    â”‚  â”‚   Pod: 10.0.1.5             Pod: 10.0.1.99 (NEW IP!)          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Client hardcodes          Client can't find pod! ğŸ’¥         â”‚  â”‚
    â”‚  â”‚   10.0.1.5                                                      â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  THE SOLUTION: SERVICES                                               â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Client â”€â”€â”€â”€â”€â”€â–º Service â”€â”€â”€â”€â”€â”€â–º Pod 1 (10.0.1.5)             â”‚  â”‚
    â”‚  â”‚                  (stable IP)  â”œâ”€â–º Pod 2 (10.0.1.6)             â”‚  â”‚
    â”‚  â”‚                  10.96.0.100  â””â”€â–º Pod 3 (10.0.1.7)             â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Pods change, Service IP stays the same                       â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 4.2: SERVICE NETWORKING (Deep Dive)
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  HOW DOES A SERVICE GET ITS IP? (ClusterIP)                           â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                            â”‚
    â”‚                                                                         â”‚
    â”‚  When you create a Service:                                           â”‚
    â”‚                                                                         â”‚
    â”‚  1. API Server assigns a ClusterIP from service CIDR (10.96.0.0/12)  â”‚
    â”‚  2. This IP is VIRTUAL - no network interface has this IP            â”‚
    â”‚  3. kube-proxy on every node creates iptables/IPVS rules             â”‚
    â”‚  4. Rules translate ClusterIP â†’ actual pod IPs                       â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   kubectl create service clusterip web --tcp=80:8080           â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚                      â”‚                                          â”‚   â”‚
    â”‚  â”‚                      â–¼                                          â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚                  API SERVER                              â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  1. Picks IP from 10.96.0.0/12 â†’ 10.96.45.100          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  2. Creates Service object                               â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  3. Endpoints Controller watches for matching pods       â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                      â”‚                                          â”‚   â”‚
    â”‚  â”‚                      â”‚ kube-proxy watches API server           â”‚   â”‚
    â”‚  â”‚                      â–¼                                          â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
    â”‚  â”‚   â”‚kube-proxyâ”‚  â”‚kube-proxyâ”‚  â”‚kube-proxyâ”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚ (Node 1) â”‚  â”‚ (Node 2) â”‚  â”‚ (Node 3) â”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚          â”‚  â”‚          â”‚  â”‚          â”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚ Creates  â”‚  â”‚ Creates  â”‚  â”‚ Creates  â”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚ iptables â”‚  â”‚ iptables â”‚  â”‚ iptables â”‚                    â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   Every node now knows: 10.96.45.100 â†’ pod endpoints          â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  KEY INSIGHT:                                                         â”‚
    â”‚  â€¢ ClusterIP is VIRTUAL (doesn't exist on any interface)            â”‚
    â”‚  â€¢ iptables INTERCEPTS packets to ClusterIP                         â”‚
    â”‚  â€¢ iptables REWRITES destination to real pod IP (DNAT)              â”‚
    â”‚  â€¢ This happens at EVERY node independently                          â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  HOW DOES SERVICE KNOW POD IPS? (Endpoints)                           â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                            â”‚
    â”‚                                                                         â”‚
    â”‚  Endpoints Controller (in controller-manager) automatically           â”‚
    â”‚  maintains list of pod IPs for each service:                          â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   SERVICE: web-service                                         â”‚   â”‚
    â”‚  â”‚   selector: app=web                                            â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚                      â”‚                                          â”‚   â”‚
    â”‚  â”‚                      â–¼                                          â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚            ENDPOINTS CONTROLLER                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  "Find all pods with label app=web"                     â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  Found:                                                  â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚    Pod-1: 10.244.1.5:8080  (Ready âœ“)                   â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚    Pod-2: 10.244.2.10:8080 (Ready âœ“)                   â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚    Pod-3: 10.244.1.20:8080 (NotReady âœ—) â† excluded    â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                      â”‚                                          â”‚   â”‚
    â”‚  â”‚                      â–¼                                          â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚            ENDPOINTS OBJECT                              â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  Name: web-service                                      â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  Subsets:                                                â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚    - Addresses:                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚        - ip: 10.244.1.5                                 â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚        - ip: 10.244.2.10                                â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚      Ports:                                              â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚        - port: 8080                                     â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                          â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  AUTOMATIC UPDATES:                                                   â”‚
    â”‚  â€¢ Pod becomes Ready â†’ added to Endpoints                            â”‚
    â”‚  â€¢ Pod becomes NotReady â†’ removed from Endpoints                     â”‚
    â”‚  â€¢ Pod deleted â†’ removed from Endpoints                              â”‚
    â”‚  â€¢ New pod created â†’ added when Ready                                â”‚
    â”‚                                                                         â”‚
    â”‚  kube-proxy watches Endpoints and updates iptables rules!            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHAT HAPPENS WHEN PODS SCALE? (Dynamic IP Management)                â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                  â”‚
    â”‚                                                                         â”‚
    â”‚  BEFORE SCALING (2 replicas):                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
    â”‚                                                                         â”‚
    â”‚  Service: web-svc (10.96.45.100)                                      â”‚
    â”‚  Endpoints: 10.244.1.5:8080, 10.244.2.10:8080                        â”‚
    â”‚                                                                         â”‚
    â”‚  iptables rules on every node:                                        â”‚
    â”‚  IF dest=10.96.45.100:80 THEN DNAT to:                               â”‚
    â”‚    - 10.244.1.5:8080  (50% probability)                              â”‚
    â”‚    - 10.244.2.10:8080 (50% probability)                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  SCALE UP TO 5 REPLICAS:                                              â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
    â”‚                                                                         â”‚
    â”‚  kubectl scale deployment web --replicas=5                            â”‚
    â”‚                                                                         â”‚
    â”‚  1. 3 new pods created with NEW IPs:                                  â”‚
    â”‚     Pod-3: 10.244.3.5:8080                                           â”‚
    â”‚     Pod-4: 10.244.1.15:8080                                          â”‚
    â”‚     Pod-5: 10.244.2.20:8080                                          â”‚
    â”‚                                                                         â”‚
    â”‚  2. Pods pass readiness probe â†’ become Ready                         â”‚
    â”‚                                                                         â”‚
    â”‚  3. Endpoints Controller detects new pods (label app=web)            â”‚
    â”‚     Updates Endpoints object with 5 IPs                               â”‚
    â”‚                                                                         â”‚
    â”‚  4. kube-proxy on EVERY node sees Endpoints change                   â”‚
    â”‚     Updates iptables rules:                                           â”‚
    â”‚                                                                         â”‚
    â”‚  iptables rules on every node (UPDATED):                             â”‚
    â”‚  IF dest=10.96.45.100:80 THEN DNAT to:                               â”‚
    â”‚    - 10.244.1.5:8080   (20% probability)                             â”‚
    â”‚    - 10.244.2.10:8080  (20% probability)                             â”‚
    â”‚    - 10.244.3.5:8080   (20% probability)  â† NEW                      â”‚
    â”‚    - 10.244.1.15:8080  (20% probability)  â† NEW                      â”‚
    â”‚    - 10.244.2.20:8080  (20% probability)  â† NEW                      â”‚
    â”‚                                                                         â”‚
    â”‚  5. New requests automatically distributed to all 5 pods!            â”‚
    â”‚     NO client changes needed - same Service IP works                 â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  SCALE DOWN TO 2 REPLICAS:                                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
    â”‚                                                                         â”‚
    â”‚  1. Kubernetes terminates 3 pods (highest ordinal first)             â”‚
    â”‚  2. Endpoints Controller removes those IPs                           â”‚
    â”‚  3. kube-proxy updates iptables (only 2 entries now)                 â”‚
    â”‚  4. Traffic automatically goes to remaining 2 pods                   â”‚
    â”‚                                                                         â”‚
    â”‚  ALL AUTOMATIC! Client just uses stable Service IP.                  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  HOW CLUSTERIP LOAD BALANCING WORKS (iptables)                        â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                         â”‚
    â”‚                                                                         â”‚
    â”‚  When pod sends request to ClusterIP:                                 â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                         NODE 1                                  â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚   â”‚
    â”‚  â”‚  â”‚   Client Pod   â”‚                                            â”‚   â”‚
    â”‚  â”‚  â”‚                â”‚                                            â”‚   â”‚
    â”‚  â”‚  â”‚ curl http://   â”‚                                            â”‚   â”‚
    â”‚  â”‚  â”‚ 10.96.45.100:80â”‚ â† ClusterIP of web-service                â”‚   â”‚
    â”‚  â”‚  â”‚                â”‚                                            â”‚   â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚   â”‚
    â”‚  â”‚          â”‚                                                      â”‚   â”‚
    â”‚  â”‚          â”‚ Packet: src=10.244.1.5 dst=10.96.45.100:80         â”‚   â”‚
    â”‚  â”‚          â–¼                                                      â”‚   â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
    â”‚  â”‚  â”‚              IPTABLES (kube-proxy rules)                â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  Chain KUBE-SERVICES:                                  â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    Match: dst=10.96.45.100 port=80                     â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    Action: Jump to KUBE-SVC-XXXX                       â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  Chain KUBE-SVC-XXXX (web-service):                    â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    - 33% â†’ KUBE-SEP-AAA (pod 10.244.1.5)              â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    - 33% â†’ KUBE-SEP-BBB (pod 10.244.2.10)             â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    - 33% â†’ KUBE-SEP-CCC (pod 10.244.3.5) â† selected   â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  Chain KUBE-SEP-CCC:                                   â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    Action: DNAT to 10.244.3.5:8080                    â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
    â”‚  â”‚          â”‚                                                      â”‚   â”‚
    â”‚  â”‚          â”‚ Packet REWRITTEN:                                   â”‚   â”‚
    â”‚  â”‚          â”‚ src=10.244.1.5 dst=10.244.3.5:8080                 â”‚   â”‚
    â”‚  â”‚          â–¼                                                      â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚          â†’ Routes to Node 3 (where 10.244.3.5 is)             â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  KEY CONCEPTS:                                                        â”‚
    â”‚  â€¢ DNAT: Destination Network Address Translation                     â”‚
    â”‚  â€¢ iptables probability rules distribute load randomly              â”‚
    â”‚  â€¢ Connection tracking (conntrack) ensures responses return         â”‚
    â”‚    to original sender                                                â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SESSION AFFINITY (Sticky Sessions)                                   â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                    â”‚
    â”‚                                                                         â”‚
    â”‚  By default, each request can go to different pod.                    â”‚
    â”‚  Sometimes you need requests from same client â†’ same pod.             â”‚
    â”‚                                                                         â”‚
    â”‚  spec:                                                                 â”‚
    â”‚    sessionAffinity: ClientIP        # Sticky by client IP            â”‚
    â”‚    sessionAffinityConfig:                                             â”‚
    â”‚      clientIP:                                                         â”‚
    â”‚        timeoutSeconds: 10800        # 3 hours                        â”‚
    â”‚                                                                         â”‚
    â”‚  HOW IT WORKS:                                                        â”‚
    â”‚  1. First request from 192.168.1.50 â†’ routed to Pod-2               â”‚
    â”‚  2. iptables remembers: 192.168.1.50 â†’ Pod-2                        â”‚
    â”‚  3. Next requests from same IP â†’ same Pod-2                         â”‚
    â”‚  4. After timeout, can go to different pod                          â”‚
    â”‚                                                                         â”‚
    â”‚  USE CASES:                                                           â”‚
    â”‚  â€¢ WebSocket connections (need same backend)                         â”‚
    â”‚  â€¢ In-memory session storage                                         â”‚
    â”‚  â€¢ File upload in chunks (same server)                               â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SERVICE VS POD PORT MAPPING (Complete Picture)                       â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
    â”‚                                                                         â”‚
    â”‚      EXTERNAL                  KUBERNETES CLUSTER                      â”‚
    â”‚      â•â•â•â•â•â•â•â•                  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
    â”‚                                                                         â”‚
    â”‚      Internet                                                          â”‚
    â”‚          â”‚                                                              â”‚
    â”‚          â”‚  User: curl http://a]4d7.elb.amazonaws.com:443             â”‚
    â”‚          â–¼                                                              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
    â”‚  â”‚  Cloud LB        â”‚  â† LoadBalancer Service creates this            â”‚
    â”‚  â”‚  Port: 443       â”‚                                                  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
    â”‚           â”‚                                                             â”‚
    â”‚           â”‚  Forwards to NodePort                                      â”‚
    â”‚           â–¼                                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                     ANY NODE                                    â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
    â”‚  â”‚  â”‚  nodePort: 31234                                        â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  iptables: port 31234 â†’ Service ClusterIP:port         â”‚   â”‚   â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
    â”‚  â”‚           â”‚                                                     â”‚   â”‚
    â”‚  â”‚           â–¼                                                     â”‚   â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
    â”‚  â”‚  â”‚  ClusterIP: 10.96.45.100                                â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  port: 443 (service port)                               â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚                                                         â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚  iptables: ClusterIP:443 â†’ Endpoints                   â”‚   â”‚   â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
    â”‚  â”‚           â”‚                                                     â”‚   â”‚
    â”‚  â”‚           â”‚  Load balance to one of:                           â”‚   â”‚
    â”‚  â”‚           â–¼                                                     â”‚   â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
    â”‚  â”‚  â”‚  Endpoints (pod IPs):                                   â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    10.244.1.5:8080  â† targetPort (container port)      â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    10.244.2.10:8080                                     â”‚   â”‚   â”‚
    â”‚  â”‚  â”‚    10.244.3.5:8080                                      â”‚   â”‚   â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  PORT MAPPING SUMMARY:                                                â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
    â”‚  CloudLB:443 â†’ NodePort:31234 â†’ ClusterIP:443 â†’ Pod:8080             â”‚
    â”‚                                                                         â”‚
    â”‚  YAML:                                                                 â”‚
    â”‚  spec:                                                                 â”‚
    â”‚    type: LoadBalancer                                                 â”‚
    â”‚    ports:                                                              â”‚
    â”‚      - port: 443          # ClusterIP port (internal access)         â”‚
    â”‚        targetPort: 8080   # Pod/container port                       â”‚
    â”‚        nodePort: 31234    # Node port (auto-assigned if not set)     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    NETWORKING VERIFICATION COMMANDS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    # See service ClusterIP
    kubectl get svc <service>
    
    # See endpoints (actual pod IPs)
    kubectl get endpoints <service>
    
    # Describe shows all networking details
    kubectl describe svc <service>
    
    # Test service from inside cluster
    kubectl run test --rm -it --image=busybox -- wget -qO- http://<clusterip>:<port>
    
    # See iptables rules (on node - requires SSH)
    sudo iptables -t nat -L KUBE-SERVICES -n
    sudo iptables -t nat -L KUBE-NODEPORTS -n


================================================================================
SECTION 4.3: SERVICE TYPES (Detailed)
================================================================================

There are 4 service types. Think of them as "how do I want to access my pods?"

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SERVICE TYPES OVERVIEW                                                â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Type          â”‚ Access From         â”‚ Use When                   â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ ClusterIP     â”‚ Inside cluster only â”‚ Internal microservices     â”‚  â”‚
    â”‚  â”‚ NodePort      â”‚ Outside via node IP â”‚ Dev/testing, bare metal    â”‚  â”‚
    â”‚  â”‚ LoadBalancer  â”‚ Outside via cloud LBâ”‚ Production on cloud        â”‚  â”‚
    â”‚  â”‚ ExternalName  â”‚ DNS alias           â”‚ External databases         â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TYPE 1: ClusterIP (Default) - INTERNAL ONLY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    WHO CAN ACCESS: Only pods INSIDE the cluster
    USE CASE: Backend services, databases, internal APIs

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  CLUSTERIP - HOW IT WORKS                                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                    KUBERNETES CLUSTER                            â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚   â”‚
    â”‚  â”‚    â”‚   Frontend    â”‚                                            â”‚   â”‚
    â”‚  â”‚    â”‚   Pod         â”‚                                            â”‚   â”‚
    â”‚  â”‚    â”‚               â”‚                                            â”‚   â”‚
    â”‚  â”‚    â”‚  curl http:// â”‚                                            â”‚   â”‚
    â”‚  â”‚    â”‚  backend-svc  â”‚                                            â”‚   â”‚
    â”‚  â”‚    â”‚  :5000        â”‚                                            â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚   â”‚
    â”‚  â”‚            â”‚                                                     â”‚   â”‚
    â”‚  â”‚            â”‚ Request to backend-svc:5000                        â”‚   â”‚
    â”‚  â”‚            â–¼                                                     â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
    â”‚  â”‚    â”‚          SERVICE: backend-svc                  â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Type: ClusterIP                       â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          ClusterIP: 10.96.45.123              â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Port: 5000                           â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚                                                â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚  DNS: backend-svc.default.svc.cluster.local   â”‚            â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
    â”‚  â”‚                        â”‚                                         â”‚   â”‚
    â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
    â”‚  â”‚            â”‚           â”‚           â”‚  Load balances             â”‚   â”‚
    â”‚  â”‚            â–¼           â–¼           â–¼                            â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
    â”‚  â”‚    â”‚  Backend  â”‚ â”‚  Backend  â”‚ â”‚  Backend  â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚  Pod 1    â”‚ â”‚  Pod 2    â”‚ â”‚  Pod 3    â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚ 10.0.1.5  â”‚ â”‚ 10.0.1.6  â”‚ â”‚ 10.0.1.7  â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚ :5000     â”‚ â”‚ :5000     â”‚ â”‚ :5000     â”‚                   â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  âŒ INTERNET CANNOT ACCESS (no external IP)                           â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    YAML:
    â”€â”€â”€â”€â”€â”€
    apiVersion: v1
    kind: Service
    metadata:
      name: backend-svc
    spec:
      type: ClusterIP              # Default, can be omitted
      selector:
        app: backend               # Matches pod labels
      ports:
        - port: 5000               # Service port (what clients use)
          targetPort: 5000         # Pod port (where app listens)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TYPE 2: NodePort - EXTERNAL VIA NODE IP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    WHO CAN ACCESS: Anyone who can reach any node's IP
    USE CASE: Development, testing, bare metal clusters (no cloud LB)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  NODEPORT - HOW IT WORKS                                               â”‚
    â”‚                                                                         â”‚
    â”‚                         INTERNET / USER                                â”‚
    â”‚                              â”‚                                          â”‚
    â”‚                              â”‚ http://192.168.1.10:30080               â”‚
    â”‚                              â”‚ (any node IP works!)                     â”‚
    â”‚                              â–¼                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                    KUBERNETES CLUSTER                            â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
    â”‚  â”‚   â”‚     NODE 1       â”‚  â”‚     NODE 2       â”‚  â”‚    NODE 3      â”‚â”‚   â”‚
    â”‚  â”‚   â”‚   192.168.1.10   â”‚  â”‚   192.168.1.11   â”‚  â”‚  192.168.1.12  â”‚â”‚   â”‚
    â”‚  â”‚   â”‚                  â”‚  â”‚                  â”‚  â”‚                â”‚â”‚   â”‚
    â”‚  â”‚   â”‚  Port 30080 OPEN â”‚  â”‚  Port 30080 OPEN â”‚  â”‚ Port 30080 OPENâ”‚â”‚   â”‚
    â”‚  â”‚   â”‚        â”‚         â”‚  â”‚        â”‚         â”‚  â”‚       â”‚        â”‚â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
    â”‚  â”‚            â”‚                     â”‚                    â”‚          â”‚   â”‚
    â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
    â”‚  â”‚                       â”‚                                          â”‚   â”‚
    â”‚  â”‚                       â–¼                                          â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
    â”‚  â”‚    â”‚          SERVICE: web-svc                      â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Type: NodePort                        â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          ClusterIP: 10.96.50.100              â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Port: 80                              â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          NodePort: 30080 â—„â”€â”€ Opens on ALL nodesâ”‚            â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
    â”‚  â”‚                        â”‚                                         â”‚   â”‚
    â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
    â”‚  â”‚            â–¼           â–¼           â–¼                            â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
    â”‚  â”‚    â”‚   Web     â”‚ â”‚   Web     â”‚ â”‚   Web     â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚   Pod 1   â”‚ â”‚   Pod 2   â”‚ â”‚   Pod 3   â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚   :80     â”‚ â”‚   :80     â”‚ â”‚   :80     â”‚                   â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  ACCESS OPTIONS:                                                       â”‚
    â”‚  â€¢ http://192.168.1.10:30080  (Node 1)                               â”‚
    â”‚  â€¢ http://192.168.1.11:30080  (Node 2)                               â”‚
    â”‚  â€¢ http://192.168.1.12:30080  (Node 3) â† Any node works!            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    YAML:
    â”€â”€â”€â”€â”€â”€
    apiVersion: v1
    kind: Service
    metadata:
      name: web-svc
    spec:
      type: NodePort
      selector:
        app: web
      ports:
        - port: 80                 # ClusterIP port (internal)
          targetPort: 80           # Pod port
          nodePort: 30080          # External port (30000-32767)
                                   # Auto-assigned if omitted

    PORT RANGE: 30000 - 32767 (configurable)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TYPE 3: LoadBalancer - EXTERNAL VIA CLOUD LOAD BALANCER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    WHO CAN ACCESS: Anyone on the internet
    USE CASE: Production apps on AWS/GCP/Azure
    REQUIREMENT: Cloud provider (creates actual LB like AWS ELB/ALB)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  LOADBALANCER - HOW IT WORKS                                           â”‚
    â”‚                                                                         â”‚
    â”‚                         INTERNET / USER                                â”‚
    â”‚                              â”‚                                          â”‚
    â”‚                              â”‚ http://a]4d7f8e9.elb.amazonaws.com     â”‚
    â”‚                              â”‚ (External IP/DNS from cloud)            â”‚
    â”‚                              â–¼                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚                 CLOUD LOAD BALANCER                                â”‚ â”‚
    â”‚  â”‚               (AWS ELB / GCP LB / Azure LB)                       â”‚ â”‚
    â”‚  â”‚                                                                    â”‚ â”‚
    â”‚  â”‚              Created automatically by Kubernetes!                 â”‚ â”‚
    â”‚  â”‚              External IP: 52.14.xxx.xxx                          â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                  â”‚                                      â”‚
    â”‚                                  â–¼                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                    KUBERNETES CLUSTER                            â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
    â”‚  â”‚   â”‚     NODE 1       â”‚  â”‚     NODE 2       â”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚                  â”‚  â”‚                  â”‚                    â”‚   â”‚
    â”‚  â”‚   â”‚  NodePort: 31234 â”‚  â”‚  NodePort: 31234 â”‚ â† LB sends here   â”‚   â”‚
    â”‚  â”‚   â”‚        â”‚         â”‚  â”‚        â”‚         â”‚                    â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
    â”‚  â”‚            â”‚                     â”‚                               â”‚   â”‚
    â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
    â”‚  â”‚                       â–¼                                          â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
    â”‚  â”‚    â”‚          SERVICE: api-svc                      â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Type: LoadBalancer                    â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          External IP: 52.14.xxx.xxx           â”‚            â”‚   â”‚
    â”‚  â”‚    â”‚          Port: 443                             â”‚            â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
    â”‚  â”‚                        â”‚                                         â”‚   â”‚
    â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
    â”‚  â”‚            â–¼           â–¼           â–¼                            â”‚   â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
    â”‚  â”‚    â”‚   API     â”‚ â”‚   API     â”‚ â”‚   API     â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚   Pod 1   â”‚ â”‚   Pod 2   â”‚ â”‚   Pod 3   â”‚                   â”‚   â”‚
    â”‚  â”‚    â”‚   :8080   â”‚ â”‚   :8080   â”‚ â”‚   :8080   â”‚                   â”‚   â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  NOTE: LoadBalancer includes NodePort + ClusterIP automatically!      â”‚
    â”‚                                                                         â”‚
    â”‚  YOUR EKS CLUSTER USES THIS TYPE!                                     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    YAML:
    â”€â”€â”€â”€â”€â”€
    apiVersion: v1
    kind: Service
    metadata:
      name: api-svc
    spec:
      type: LoadBalancer
      selector:
        app: api
      ports:
        - port: 443                # External port
          targetPort: 8080         # Pod port

    CHECK EXTERNAL IP:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    kubectl get svc api-svc
    # NAME     TYPE           CLUSTER-IP    EXTERNAL-IP         PORT(S)
    # api-svc  LoadBalancer   10.96.0.100   52.14.xxx.xxx      443:31234/TCP


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TYPE 4: ExternalName - DNS ALIAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    WHO CAN ACCESS: Pods inside cluster (for reaching external services)
    USE CASE: Connect to external databases, third-party APIs
    NO PROXYING: Just a DNS CNAME record

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  EXTERNALNAME - HOW IT WORKS                                           â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                    KUBERNETES CLUSTER                            â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚   â”‚
    â”‚  â”‚   â”‚   Your Pod    â”‚                                             â”‚   â”‚
    â”‚  â”‚   â”‚               â”‚                                             â”‚   â”‚
    â”‚  â”‚   â”‚  curl http:// â”‚                                             â”‚   â”‚
    â”‚  â”‚   â”‚  my-database  â”‚                                             â”‚   â”‚
    â”‚  â”‚   â”‚               â”‚                                             â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚   â”‚
    â”‚  â”‚           â”‚                                                      â”‚   â”‚
    â”‚  â”‚           â”‚ DNS lookup: my-database                             â”‚   â”‚
    â”‚  â”‚           â–¼                                                      â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚
    â”‚  â”‚   â”‚    SERVICE: my-database                    â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚    Type: ExternalName                      â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚                                            â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚    Returns CNAME:                          â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚    db.rds.amazonaws.com                    â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚                                            â”‚                â”‚   â”‚
    â”‚  â”‚   â”‚    (No ClusterIP, no pods!)               â”‚                â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   â”‚
    â”‚  â”‚                        â”‚                                         â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                           â”‚                                             â”‚
    â”‚                           â”‚ Resolves to external DNS                   â”‚
    â”‚                           â–¼                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚              EXTERNAL SERVICE (Outside Cluster)                  â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â”‚     AWS RDS Database: db.rds.amazonaws.com                      â”‚   â”‚
    â”‚  â”‚                                                                  â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  BENEFIT: If database URL changes, just update Service                â”‚
    â”‚           (pods don't need to know the real URL)                      â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    YAML:
    â”€â”€â”€â”€â”€â”€
    apiVersion: v1
    kind: Service
    metadata:
      name: my-database
    spec:
      type: ExternalName
      externalName: db.rds.amazonaws.com     # No selector, no ports!


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BONUS: HEADLESS SERVICE (clusterIP: None)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    NOT A TYPE, but a special configuration of ClusterIP
    USE CASE: StatefulSets, when you need to reach specific pods

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  HEADLESS SERVICE - NO CLUSTER IP                                      â”‚
    â”‚                                                                         â”‚
    â”‚  NORMAL SERVICE:           HEADLESS SERVICE:                           â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
    â”‚                                                                         â”‚
    â”‚  DNS: my-svc               DNS: my-svc                                 â”‚
    â”‚       â†“                         â†“                                      â”‚
    â”‚  Returns: 10.96.0.100      Returns: 10.0.1.5                          â”‚
    â”‚  (single ClusterIP)                 10.0.1.6                          â”‚
    â”‚                                     10.0.1.7                          â”‚
    â”‚                            (all pod IPs!)                              â”‚
    â”‚                                                                         â”‚
    â”‚  Client â†’ Service â†’ Pod    Client can pick specific pod               â”‚
    â”‚  (random pod)              postgres-0.postgres-svc                     â”‚
    â”‚                            postgres-1.postgres-svc                     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    YAML:
    â”€â”€â”€â”€â”€â”€
    apiVersion: v1
    kind: Service
    metadata:
      name: postgres-svc
    spec:
      clusterIP: None            # â† This makes it headless!
      selector:
        app: postgres
      ports:
        - port: 5432


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
COMPARISON: WHICH SERVICE TYPE TO USE?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DECISION TREE                                                         â”‚
    â”‚                                                                         â”‚
    â”‚  Need external access?                                                 â”‚
    â”‚       â”‚                                                                â”‚
    â”‚       â”œâ”€â”€ NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ClusterIP                               â”‚
    â”‚       â”‚                       (internal microservices)                â”‚
    â”‚       â”‚                                                                â”‚
    â”‚       â””â”€â”€ YES                                                          â”‚
    â”‚            â”‚                                                           â”‚
    â”‚            â”œâ”€â”€ On cloud (AWS/GCP/Azure)?                              â”‚
    â”‚            â”‚        â”‚                                                  â”‚
    â”‚            â”‚        â”œâ”€â”€ YES â”€â”€â–º LoadBalancer (production)             â”‚
    â”‚            â”‚        â”‚                                                  â”‚
    â”‚            â”‚        â””â”€â”€ NO â”€â”€â”€â–º NodePort (dev, bare metal)            â”‚
    â”‚            â”‚                                                           â”‚
    â”‚            â””â”€â”€ Just need DNS alias to external service?               â”‚
    â”‚                     â”‚                                                  â”‚
    â”‚                     â””â”€â”€ YES â”€â”€â–º ExternalName                          â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
    â”‚                                                                         â”‚
    â”‚  REAL WORLD EXAMPLES:                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ Backend API â†’ calls â†’ Database Service (ClusterIP)                â”‚
    â”‚  â€¢ Frontend â†’ exposed via â†’ LoadBalancer (users access)              â”‚
    â”‚  â€¢ Testing locally â†’ NodePort (minikube)                             â”‚
    â”‚  â€¢ Connect to AWS RDS â†’ ExternalName                                 â”‚
    â”‚  â€¢ PostgreSQL StatefulSet â†’ Headless Service                         â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


COMMANDS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€

    # Create services
    kubectl expose deployment <deploy> --port=80 --type=ClusterIP
    kubectl expose deployment <deploy> --port=80 --type=NodePort
    kubectl expose deployment <deploy> --port=80 --type=LoadBalancer

    # View services
    kubectl get svc
    kubectl get svc -o wide
    kubectl describe svc <service-name>

    # See which pods service routes to
    kubectl get endpoints <service-name>

    # Test service from inside cluster
    kubectl run test --rm -it --image=busybox -- wget -qO- http://<service>:<port>


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HOW DOES TRAFFIC FORWARDING WORK? (kube-proxy + iptables)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    QUESTION: If request arrives at Node 1, but Pod is on Node 2,
              how does Node 1 know where to forward the traffic?

    ANSWER: kube-proxy on EVERY node maintains iptables rules
            that know ALL pod locations!


    STEP 1: SERVICE CREATED â†’ KUBE-PROXY NOTIFIED
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚    kubectl apply -f service.yaml                                       â”‚
    â”‚              â”‚                                                          â”‚
    â”‚              â–¼                                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
    â”‚    â”‚    API Server    â”‚                                                â”‚
    â”‚    â”‚                  â”‚                                                â”‚
    â”‚    â”‚  Stores:         â”‚                                                â”‚
    â”‚    â”‚  - Service       â”‚                                                â”‚
    â”‚    â”‚  - Endpoints     â”‚â—„â”€â”€ Endpoints Controller updates this          â”‚
    â”‚    â”‚    (pod IPs)     â”‚    whenever pods are added/removed            â”‚
    â”‚    â”‚                  â”‚                                                â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
    â”‚             â”‚                                                          â”‚
    â”‚             â”‚  kube-proxy WATCHES for changes                         â”‚
    â”‚             â–¼                                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚    â”‚  kube-proxy  â”‚  â”‚  kube-proxy  â”‚  â”‚  kube-proxy  â”‚              â”‚
    â”‚    â”‚   (Node 1)   â”‚  â”‚   (Node 2)   â”‚  â”‚   (Node 3)   â”‚              â”‚
    â”‚    â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
    â”‚    â”‚ Creates      â”‚  â”‚ Creates      â”‚  â”‚ Creates      â”‚              â”‚
    â”‚    â”‚ iptables!    â”‚  â”‚ iptables!    â”‚  â”‚ iptables!    â”‚              â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â”‚                                                                         â”‚
    â”‚    ALL nodes now have iptables rules:                                 â”‚
    â”‚    "Port 30080 â†’ forward to 10.0.2.5 OR 10.0.2.6"                    â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 2: REQUEST ARRIVES AT NODE WITHOUT POD
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚    Client Request: http://192.168.1.10:30080                          â”‚
    â”‚                              â”‚                                          â”‚
    â”‚                              â–¼                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚    â”‚                        NODE 1                                   â”‚  â”‚
    â”‚    â”‚                   192.168.1.10                                 â”‚  â”‚
    â”‚    â”‚                                                                 â”‚  â”‚
    â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚    â”‚    â”‚                    IPTABLES                             â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚              (created by kube-proxy)                    â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚                                                         â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚  Rule: If port = 30080, DNAT to one of:                â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚        - 10.0.2.5:80  (Pod on Node 2) â—„â”€â”€ Selected!   â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚        - 10.0.2.6:80  (Pod on Node 3)                  â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚                                                         â”‚  â”‚  â”‚
    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚    â”‚                         â”‚                                       â”‚  â”‚
    â”‚    â”‚    NO POD HERE!         â”‚ Packet rewritten:                    â”‚  â”‚
    â”‚    â”‚    Just forwards        â”‚ Dest: 10.0.2.5:80                    â”‚  â”‚
    â”‚    â”‚                         â”‚                                       â”‚  â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                              â”‚                                          â”‚
    â”‚                              â”‚ Cluster network                         â”‚
    â”‚                              â–¼                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚    â”‚                        NODE 2                                   â”‚  â”‚
    â”‚    â”‚                                                                 â”‚  â”‚
    â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚    â”‚    â”‚                      POD                                â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚                 IP: 10.0.2.5:80                         â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚                                                         â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚           â—„â”€â”€â”€â”€ Request arrives here!                  â”‚  â”‚  â”‚
    â”‚    â”‚    â”‚                                                         â”‚  â”‚  â”‚
    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚    â”‚                                                                 â”‚  â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    KEY COMPONENTS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  COMPONENT        â”‚ ROLE                                               â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  Endpoints        â”‚ List of pod IPs backing a service                 â”‚
    â”‚  Controller       â”‚ Updates when pods added/removed                   â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  kube-proxy       â”‚ Runs on EVERY node                                â”‚
    â”‚                   â”‚ Watches API server for service/endpoint changes   â”‚
    â”‚                   â”‚ Creates iptables/IPVS rules                       â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  iptables         â”‚ Linux kernel packet filtering                     â”‚
    â”‚                   â”‚ Does actual packet forwarding (DNAT)              â”‚
    â”‚                   â”‚ Selects backend randomly or round-robin           â”‚
    â”‚                   â”‚                                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    VERIFY WITH COMMANDS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    # See endpoints (pod IPs) for a service
    kubectl get endpoints <service-name>
    # Output: NAME      ENDPOINTS                    AGE
    #         web-svc   10.0.2.5:80,10.0.2.6:80     5m

    # View kube-proxy pods
    kubectl get pods -n kube-system -l k8s-app=kube-proxy

    # On a node, see iptables rules (SSH into node)
    sudo iptables -t nat -L KUBE-SERVICES -n | grep <service-name>


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PORT MAPPING EXPLAINED: nodePort vs port vs targetPort
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    THREE TYPES OF PORTS IN A SERVICE:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  PORT             â”‚ WHAT IT IS                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  nodePort         â”‚ Port OPENED on ALL nodes (30000-32767)            â”‚
    â”‚                   â”‚ External users access via: <NodeIP>:<nodePort>    â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  port             â”‚ Port on the SERVICE (ClusterIP)                   â”‚
    â”‚                   â”‚ Pods inside cluster access via: <ServiceIP>:<port>â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚  targetPort       â”‚ Port on the POD where container listens           â”‚
    â”‚                   â”‚ This is where traffic finally arrives             â”‚
    â”‚                   â”‚                                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    CONCRETE EXAMPLE:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    apiVersion: v1
    kind: Service
    metadata:
      name: web-svc
    spec:
      type: NodePort
      selector:
        app: web
      ports:
        - nodePort: 30080      # External: http://<node-ip>:30080
          port: 80             # Internal: http://web-svc:80
          targetPort: 8080     # Container listens on 8080


    VISUAL MAPPING:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚   EXTERNAL USER                                                         â”‚
    â”‚        â”‚                                                                â”‚
    â”‚        â”‚  http://192.168.1.10:30080                                    â”‚
    â”‚        â”‚                     â–²                                          â”‚
    â”‚        â”‚                     â”‚                                          â”‚
    â”‚        â”‚                 nodePort: 30080                               â”‚
    â”‚        â–¼                                                                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚                    ANY NODE                                      â”‚  â”‚
    â”‚   â”‚             (192.168.1.10, 192.168.1.11, etc.)                  â”‚  â”‚
    â”‚   â”‚                                                                  â”‚  â”‚
    â”‚   â”‚   Port 30080 is OPEN on ALL nodes in cluster                   â”‚  â”‚
    â”‚   â”‚                                                                  â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                             â”‚                                          â”‚
    â”‚                             â”‚ iptables DNAT                            â”‚
    â”‚                             â–¼                                          â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚              SERVICE: web-svc                                    â”‚  â”‚
    â”‚   â”‚              ClusterIP: 10.96.0.100                             â”‚  â”‚
    â”‚   â”‚              Port: 80                                            â”‚  â”‚
    â”‚   â”‚                       â–²                                          â”‚  â”‚
    â”‚   â”‚                       â”‚                                          â”‚
    â”‚   â”‚              Internal pods use: http://web-svc:80               â”‚  â”‚
    â”‚   â”‚              Or: http://10.96.0.100:80                          â”‚  â”‚
    â”‚   â”‚                                                                  â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                             â”‚                                          â”‚
    â”‚                             â”‚ Load balance to endpoints                â”‚
    â”‚                             â–¼                                          â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚                    PODS (endpoints)                              â”‚  â”‚
    â”‚   â”‚                                                                  â”‚  â”‚
    â”‚   â”‚   10.0.2.5:8080    10.0.2.6:8080    10.0.2.7:8080              â”‚  â”‚
    â”‚   â”‚       â–²                 â–²                 â–²                      â”‚  â”‚
    â”‚   â”‚       â”‚                 â”‚                 â”‚                      â”‚  â”‚
    â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚
    â”‚   â”‚                         â”‚                                        â”‚  â”‚
    â”‚   â”‚                   targetPort: 8080                              â”‚  â”‚
    â”‚   â”‚              (container port in pod)                            â”‚  â”‚
    â”‚   â”‚                                                                  â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP-BY-STEP: USER HITS NODE1, POD ON NODE2
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    SETUP:
    â€¢ Node 1 IP: 192.168.1.10 (NO pods here)
    â€¢ Node 2 IP: 192.168.1.11 (Pod is here: 10.0.2.5)
    â€¢ Node 3 IP: 192.168.1.12 (NO pods here)
    â€¢ Service: nodePort=30080, port=80, targetPort=8080

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  USER REQUEST: curl http://192.168.1.10:30080                         â”‚
    â”‚  (hitting Node 1, but pod is on Node 2!)                              â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
    â”‚                                                                         â”‚
    â”‚  STEP 1: Packet arrives at Node 1                                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
    â”‚                                                                         â”‚
    â”‚     Source IP: Client (203.0.113.50)                                  â”‚
    â”‚     Dest IP:   192.168.1.10 (Node 1)                                  â”‚
    â”‚     Dest Port: 30080 (nodePort)                                       â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
    â”‚                                                                         â”‚
    â”‚  STEP 2: iptables on Node 1 matches the packet                        â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
    â”‚                                                                         â”‚
    â”‚     kube-proxy has installed these rules on EVERY node:               â”‚
    â”‚                                                                         â”‚
    â”‚     Rule: IF dest_port == 30080                                       â”‚
    â”‚           THEN DNAT to one of: 10.0.2.5:8080                         â”‚
    â”‚           (randomly selected from endpoints)                          â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
    â”‚                                                                         â”‚
    â”‚  STEP 3: Packet is REWRITTEN (DNAT)                                   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
    â”‚                                                                         â”‚
    â”‚     BEFORE:                       AFTER:                              â”‚
    â”‚     Dest: 192.168.1.10:30080  â†’  Dest: 10.0.2.5:8080                â”‚
    â”‚     (Node 1 IP:nodePort)          (Pod IP:targetPort)                 â”‚
    â”‚                                                                         â”‚
    â”‚     Source IP remains: 203.0.113.50 (client)                         â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
    â”‚                                                                         â”‚
    â”‚  STEP 4: Packet forwarded via cluster network                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
    â”‚                                                                         â”‚
    â”‚     Node 1 â†’ CNI network (flannel/calico) â†’ Node 2                   â”‚
    â”‚                                                                         â”‚
    â”‚     Packet reaches pod at 10.0.2.5:8080                              â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
    â”‚                                                                         â”‚
    â”‚  STEP 5: Response flows back (reverse NAT)                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
    â”‚                                                                         â”‚
    â”‚     Pod 10.0.2.5 â†’ Node 2 â†’ Node 1 â†’ Client                          â”‚
    â”‚                                                                         â”‚
    â”‚     iptables connection tracking (conntrack) remembers                â”‚
    â”‚     the original request and reverses the NAT                         â”‚
    â”‚                                                                         â”‚
    â”‚     Response to client: Source appears as 192.168.1.10:30080         â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    KEY INSIGHT: WHY THIS WORKS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  1. nodePort IS UNIQUE CLUSTER-WIDE                                   â”‚
    â”‚     If service uses 30080, NO other service can use 30080            â”‚
    â”‚     This is enforced by Kubernetes                                    â”‚
    â”‚                                                                         â”‚
    â”‚  2. EVERY NODE LISTENS ON THE SAME nodePort                           â”‚
    â”‚     Node 1:30080, Node 2:30080, Node 3:30080 - ALL work!            â”‚
    â”‚     User can hit ANY node, they all forward correctly                â”‚
    â”‚                                                                         â”‚
    â”‚  3. kube-proxy KNOWS ALL POD LOCATIONS                                â”‚
    â”‚     Watches API server for endpoint updates                          â”‚
    â”‚     Creates iptables rules with ALL pod IPs                          â”‚
    â”‚                                                                         â”‚
    â”‚  4. POD CAN BE ANYWHERE                                               â”‚
    â”‚     Doesn't matter if pod is on same node or different node          â”‚
    â”‚     iptables + cluster network handles routing                       â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    COMMON SCENARIOS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SCENARIO 1: User hits Node 1, Pod on Node 2                          â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
    â”‚  â€¢ iptables on Node 1 rewrites dest to pod IP                        â”‚
    â”‚  â€¢ Forwards across cluster network to Node 2                         â”‚
    â”‚  â€¢ Works perfectly! âœ“                                                 â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  SCENARIO 2: User hits Node 2, Pod also on Node 2                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
    â”‚  â€¢ iptables on Node 2 rewrites dest to pod IP                        â”‚
    â”‚  â€¢ Pod is local, traffic stays on Node 2                             â”‚
    â”‚  â€¢ Works perfectly! âœ“                                                 â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  SCENARIO 3: Multiple pods, spread across nodes                       â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
    â”‚  â€¢ iptables randomly selects one pod from endpoints                  â”‚
    â”‚  â€¢ Could be local or remote - doesn't matter                         â”‚
    â”‚  â€¢ Built-in load balancing! âœ“                                        â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    PORTS CAN BE SAME OR DIFFERENT:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  EXAMPLE 1: All ports different (common)                              â”‚
    â”‚                                                                         â”‚
    â”‚     nodePort: 30080   â†’ Service port: 80   â†’ targetPort: 8080        â”‚
    â”‚                                                                         â”‚
    â”‚     curl http://node-ip:30080                                         â”‚
    â”‚       â†’ iptables â†’ 10.96.0.100:80 (clusterIP)                        â”‚
    â”‚       â†’ endpoints â†’ 10.0.2.5:8080 (pod)                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  EXAMPLE 2: All ports same (also valid)                               â”‚
    â”‚                                                                         â”‚
    â”‚     nodePort: 30080   â†’ Service port: 30080 â†’ targetPort: 30080      â”‚
    â”‚                                                                         â”‚
    â”‚     Less common, but works fine                                       â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  EXAMPLE 3: Service port = targetPort (very common for ClusterIP)    â”‚
    â”‚                                                                         â”‚
    â”‚     Service port: 80 â†’ targetPort: 80                                â”‚
    â”‚                                                                         â”‚
    â”‚     If ports match, you can omit targetPort:                         â”‚
    â”‚     ports:                                                            â”‚
    â”‚       - port: 80      # targetPort defaults to same value            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    QUICK REFERENCE:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    # See all three ports in service
    kubectl get svc <service> -o wide

    # See endpoints (where traffic actually goes)
    kubectl get endpoints <service>

    # Describe shows full port mapping
    kubectl describe svc <service>

    # Example output:
    # Port:                     <unset>  80/TCP
    # TargetPort:               8080/TCP
    # NodePort:                 <unset>  30080/TCP
    # Endpoints:                10.0.2.5:8080,10.0.2.6:8080


================================================================================
SECTION 4.3: SERVICE DISCOVERY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DNS-BASED DISCOVERY                                                   â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  Every Service gets a DNS entry automatically.                        â”‚
    â”‚                                                                         â”‚
    â”‚  DNS FORMAT:                                                           â”‚
    â”‚  <service>.<namespace>.svc.cluster.local                              â”‚
    â”‚                                                                         â”‚
    â”‚  EXAMPLES:                                                             â”‚
    â”‚  my-service.default.svc.cluster.local                                 â”‚
    â”‚  my-service.default.svc                                               â”‚
    â”‚  my-service.default                                                    â”‚
    â”‚  my-service  (if in same namespace)                                   â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  ENVIRONMENT VARIABLES                                                 â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  Kubernetes injects env vars for each Service:                       â”‚
    â”‚                                                                         â”‚
    â”‚  MY_SERVICE_SERVICE_HOST=10.96.0.100                                  â”‚
    â”‚  MY_SERVICE_SERVICE_PORT=80                                           â”‚
    â”‚                                                                         â”‚
    â”‚  Note: Only for services that exist when pod starts.                 â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  HEADLESS SERVICE                                                      â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  No cluster IP. DNS returns pod IPs directly.                        â”‚
    â”‚  Useful for StatefulSets.                                             â”‚
    â”‚                                                                         â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    clusterIP: None                                                     â”‚
    â”‚    selector:                                                            â”‚
    â”‚      app: myapp                                                        â”‚
    â”‚    ports:                                                               â”‚
    â”‚      - port: 80                                                        â”‚
    â”‚                                                                         â”‚
    â”‚  DNS returns: 10.0.1.5, 10.0.1.6, 10.0.1.7 (all pod IPs)            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 4.4: PRACTICAL EXAMPLES
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  COMPLETE DEPLOYMENT + SERVICE                                        â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: apps/v1                                                   â”‚
    â”‚  kind: Deployment                                                       â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: web-app                                                       â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    replicas: 3                                                         â”‚
    â”‚    selector:                                                            â”‚
    â”‚      matchLabels:                                                       â”‚
    â”‚        app: web                                                        â”‚
    â”‚    template:                                                            â”‚
    â”‚      metadata:                                                          â”‚
    â”‚        labels:                                                          â”‚
    â”‚          app: web                                                      â”‚
    â”‚      spec:                                                              â”‚
    â”‚        containers:                                                      â”‚
    â”‚          - name: web                                                   â”‚
    â”‚            image: nginx:1.25                                           â”‚
    â”‚            ports:                                                       â”‚
    â”‚              - containerPort: 80                                       â”‚
    â”‚  ---                                                                    â”‚
    â”‚  apiVersion: v1                                                        â”‚
    â”‚  kind: Service                                                          â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: web-service                                                   â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    selector:                                                            â”‚
    â”‚      app: web        # Matches pod labels                             â”‚
    â”‚    ports:                                                               â”‚
    â”‚      - port: 80                                                        â”‚
    â”‚        targetPort: 80                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  COMMANDS                                                              â”‚
    â”‚                                                                         â”‚
    â”‚  kubectl get svc                                                       â”‚
    â”‚  kubectl describe svc web-service                                     â”‚
    â”‚  kubectl get endpoints web-service                                    â”‚
    â”‚                                                                         â”‚
    â”‚  # Expose deployment quickly                                          â”‚
    â”‚  kubectl expose deployment web-app --port=80 --type=LoadBalancer     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
CHAPTER SUMMARY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SERVICES - KEY TAKEAWAYS                                             â”‚
    â”‚                                                                         â”‚
    â”‚  SERVICE TYPES                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
    â”‚  â€¢ ClusterIP: Internal only (default)                                â”‚
    â”‚  â€¢ NodePort: External via node port                                  â”‚
    â”‚  â€¢ LoadBalancer: External via cloud LB                              â”‚
    â”‚  â€¢ ExternalName: DNS alias                                           â”‚
    â”‚                                                                         â”‚
    â”‚  DISCOVERY                                                             â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
    â”‚  â€¢ DNS: service.namespace.svc.cluster.local                         â”‚
    â”‚  â€¢ Environment variables                                             â”‚
    â”‚  â€¢ Headless: clusterIP: None                                        â”‚
    â”‚                                                                         â”‚
    â”‚  SELECTOR                                                              â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
    â”‚  Service selector must match pod labels                              â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                              END OF CHAPTER 4
================================================================================

