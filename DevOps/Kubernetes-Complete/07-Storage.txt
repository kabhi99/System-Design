================================================================================
                    KUBERNETES STORAGE
                    Chapter 7: Persistent Volumes and Storage Classes
================================================================================

Kubernetes provides a powerful abstraction for storage that separates
storage provisioning from consumption.


================================================================================
SECTION 7.1: WHY PERSISTENT STORAGE?
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE PROBLEM: PODS ARE EPHEMERAL                                      â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                       â”‚
    â”‚                                                                         â”‚
    â”‚  Without persistent storage:                                           â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   MySQL Pod                                                    â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  Container filesystem                                  â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  /var/lib/mysql (data stored here)                    â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  users table: 10,000 records                          â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  orders table: 50,000 records                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   Pod crashes or gets rescheduled...                          â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚                        ğŸ’¥ POD DIES                             â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   ALL DATA LOST! Container filesystem is GONE.                â”‚   â”‚
    â”‚  â”‚   New pod starts with EMPTY database!                         â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  PROBLEMS:                                                             â”‚
    â”‚                                                                         â”‚
    â”‚  1. DATA LOSS ON RESTART                                              â”‚
    â”‚     â€¢ Container storage is temporary                                  â”‚
    â”‚     â€¢ When pod dies, data dies with it                               â”‚
    â”‚                                                                         â”‚
    â”‚  2. NO SHARING BETWEEN CONTAINERS                                     â”‚
    â”‚     â€¢ Each container has isolated filesystem                         â”‚
    â”‚     â€¢ Can't share data between containers in pod                     â”‚
    â”‚                                                                         â”‚
    â”‚  3. NO DATA PERSISTENCE ACROSS RESCHEDULING                          â”‚
    â”‚     â€¢ Pod moves to different node â†’ data stays on old node          â”‚
    â”‚     â€¢ New pod can't access the old data                              â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE SOLUTION: PERSISTENT VOLUMES                                      â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   MySQL Pod                                                    â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  Container mounts external volume:                     â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  /var/lib/mysql â†’ PersistentVolume                    â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                         â”‚                              â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                             â”‚                                  â”‚   â”‚
    â”‚  â”‚   Pod crashes...            â”‚                                  â”‚   â”‚
    â”‚  â”‚                             â”‚                                  â”‚   â”‚
    â”‚  â”‚             ğŸ’¥              â”‚                                  â”‚   â”‚
    â”‚  â”‚                             â”‚                                  â”‚   â”‚
    â”‚  â”‚   New pod created...        â”‚                                  â”‚   â”‚
    â”‚  â”‚                             â”‚                                  â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚  Container remounts:    â”‚                              â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚  /var/lib/mysql â†’ PersistentVolume                    â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                             â”‚                                  â”‚   â”‚
    â”‚  â”‚                             â–¼                                  â”‚   â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
    â”‚  â”‚   â”‚           PERSISTENT VOLUME (AWS EBS)                  â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚   Data SURVIVES pod restarts!                         â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚   users: 10,000 records âœ“                            â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚   orders: 50,000 records âœ“                           â”‚  â”‚   â”‚
    â”‚  â”‚   â”‚                                                         â”‚  â”‚   â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHY PV + PVC SEPARATION? (Two-Layer Abstraction)                     â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                      â”‚
    â”‚                                                                         â”‚
    â”‚  PROBLEM: Different roles, different concerns                         â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   DEVELOPER (app team):              ADMIN (ops team):         â”‚   â”‚
    â”‚  â”‚   "I need 10Gi storage"              "I'll create AWS EBS      â”‚   â”‚
    â”‚  â”‚   "I don't care HOW"                  with encryption,         â”‚   â”‚
    â”‚  â”‚                                       IOPS, backup policy"     â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â”‚   Creates: PVC                       Creates: PV               â”‚   â”‚
    â”‚  â”‚   (what I need)                      (how to provide it)       â”‚   â”‚
    â”‚  â”‚                                                                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  BENEFITS:                                                             â”‚
    â”‚                                                                         â”‚
    â”‚  1. SEPARATION OF CONCERNS                                            â”‚
    â”‚     â€¢ Dev doesn't need to know storage details                       â”‚
    â”‚     â€¢ Admin manages storage infrastructure                           â”‚
    â”‚                                                                         â”‚
    â”‚  2. PORTABILITY                                                        â”‚
    â”‚     â€¢ Same PVC works on AWS, GCP, on-prem                            â”‚
    â”‚     â€¢ Admin provides different PVs per environment                   â”‚
    â”‚                                                                         â”‚
    â”‚  3. REUSABILITY                                                        â”‚
    â”‚     â€¢ Admin creates storage once                                     â”‚
    â”‚     â€¢ Multiple apps can claim it                                     â”‚
    â”‚                                                                         â”‚
    â”‚  4. SECURITY                                                           â”‚
    â”‚     â€¢ Dev doesn't need AWS/cloud credentials                        â”‚
    â”‚     â€¢ Admin controls storage policies                                â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHEN TO USE PERSISTENT STORAGE                                       â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                        â”‚
    â”‚                                                                         â”‚
    â”‚  USE PERSISTENT VOLUMES FOR:                                          â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
    â”‚  â€¢ Databases (MySQL, PostgreSQL, MongoDB)                            â”‚
    â”‚  â€¢ Message queues (Kafka, RabbitMQ)                                  â”‚
    â”‚  â€¢ File uploads (user content)                                       â”‚
    â”‚  â€¢ Application logs (if persisting to disk)                          â”‚
    â”‚  â€¢ Cache that needs to survive restarts (Redis with persistence)    â”‚
    â”‚  â€¢ Stateful applications (Elasticsearch, Cassandra)                  â”‚
    â”‚                                                                         â”‚
    â”‚  DON'T NEED PERSISTENT VOLUMES FOR:                                   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
    â”‚  â€¢ Stateless web servers                                              â”‚
    â”‚  â€¢ API services (state in external DB)                               â”‚
    â”‚  â€¢ Temporary processing (data discarded after)                       â”‚
    â”‚  â€¢ Cache that can be rebuilt (Redis as pure cache)                   â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 7.2: STORAGE CONCEPTS
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE STORAGE ABSTRACTION                                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Pod                                                          â”‚  â”‚
    â”‚  â”‚    â”‚                                                            â”‚  â”‚
    â”‚  â”‚    â”‚ "I need 10Gi of storage"                                  â”‚  â”‚
    â”‚  â”‚    â–¼                                                            â”‚  â”‚
    â”‚  â”‚   PersistentVolumeClaim (PVC)  â† Developer creates            â”‚  â”‚
    â”‚  â”‚    â”‚                                                            â”‚  â”‚
    â”‚  â”‚    â”‚ Binds to                                                  â”‚  â”‚
    â”‚  â”‚    â–¼                                                            â”‚  â”‚
    â”‚  â”‚   PersistentVolume (PV)        â† Admin creates (or dynamic)   â”‚  â”‚
    â”‚  â”‚    â”‚                                                            â”‚  â”‚
    â”‚  â”‚    â”‚ Backed by                                                 â”‚  â”‚
    â”‚  â”‚    â–¼                                                            â”‚  â”‚
    â”‚  â”‚   Actual Storage (AWS EBS, GCE PD, NFS, etc.)                 â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  PV: The actual storage resource (created by admin)                  â”‚
    â”‚  PVC: A request for storage (created by developer)                   â”‚
    â”‚  StorageClass: Template for DYNAMIC provisioning (auto-create PV)   â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 7.2: PERSISTENT VOLUMES
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  PERSISTENT VOLUME (Admin creates)                                    â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                    â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: v1                                                        â”‚
    â”‚  kind: PersistentVolume                                                â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: my-pv                                                         â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    capacity:                                                            â”‚
    â”‚      storage: 10Gi                                                     â”‚
    â”‚    accessModes:                                                         â”‚
    â”‚      - ReadWriteOnce                                                   â”‚
    â”‚    persistentVolumeReclaimPolicy: Retain                              â”‚
    â”‚    storageClassName: standard                                          â”‚
    â”‚    hostPath:                     # For testing only                   â”‚
    â”‚      path: /data/my-pv                                                 â”‚
    â”‚                                                                         â”‚
    â”‚  # Or with cloud storage                                               â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    awsElasticBlockStore:                                               â”‚
    â”‚      volumeID: vol-12345678                                           â”‚
    â”‚      fsType: ext4                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  ACCESS MODES                                                          â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ ReadWriteOnce (RWO): Single node read-write                       â”‚
    â”‚  â€¢ ReadOnlyMany (ROX): Multiple nodes read-only                      â”‚
    â”‚  â€¢ ReadWriteMany (RWX): Multiple nodes read-write                    â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  RECLAIM POLICIES                                                      â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ Retain: Keep data after PVC deleted (manual cleanup)             â”‚
    â”‚  â€¢ Delete: Delete storage when PVC deleted                          â”‚
    â”‚  â€¢ Recycle: Basic scrub (deprecated)                                 â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 7.3: PERSISTENT VOLUME CLAIMS
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  PVC (User requests)                                                   â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: v1                                                        â”‚
    â”‚  kind: PersistentVolumeClaim                                           â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: my-pvc                                                        â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    accessModes:                                                         â”‚
    â”‚      - ReadWriteOnce                                                   â”‚
    â”‚    resources:                                                           â”‚
    â”‚      requests:                                                          â”‚
    â”‚        storage: 5Gi                                                    â”‚
    â”‚    storageClassName: standard                                          â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  USING PVC IN POD                                                      â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: v1                                                        â”‚
    â”‚  kind: Pod                                                              â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: my-pod                                                        â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    containers:                                                          â”‚
    â”‚      - name: app                                                       â”‚
    â”‚        image: nginx                                                    â”‚
    â”‚        volumeMounts:                                                    â”‚
    â”‚          - mountPath: /data                                           â”‚
    â”‚            name: my-storage                                            â”‚
    â”‚    volumes:                                                             â”‚
    â”‚      - name: my-storage                                                â”‚
    â”‚        persistentVolumeClaim:                                          â”‚
    â”‚          claimName: my-pvc                                             â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 7.4: STORAGE CLASSES
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DYNAMIC PROVISIONING                                                  â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  StorageClass lets Kubernetes create PVs automatically.              â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: storage.k8s.io/v1                                        â”‚
    â”‚  kind: StorageClass                                                     â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: fast-ssd                                                      â”‚
    â”‚  provisioner: kubernetes.io/aws-ebs                                   â”‚
    â”‚  parameters:                                                            â”‚
    â”‚    type: gp3                                                           â”‚
    â”‚    iopsPerGB: "50"                                                     â”‚
    â”‚  reclaimPolicy: Delete                                                 â”‚
    â”‚  volumeBindingMode: WaitForFirstConsumer                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  PVC WITH STORAGECLASS                                                 â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
    â”‚                                                                         â”‚
    â”‚  apiVersion: v1                                                        â”‚
    â”‚  kind: PersistentVolumeClaim                                           â”‚
    â”‚  metadata:                                                              â”‚
    â”‚    name: fast-storage                                                  â”‚
    â”‚  spec:                                                                  â”‚
    â”‚    accessModes:                                                         â”‚
    â”‚      - ReadWriteOnce                                                   â”‚
    â”‚    storageClassName: fast-ssd    # Use StorageClass                  â”‚
    â”‚    resources:                                                           â”‚
    â”‚      requests:                                                          â”‚
    â”‚        storage: 100Gi                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  Kubernetes automatically provisions the volume!                      â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  COMMON PROVISIONERS                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ kubernetes.io/aws-ebs (AWS EBS)                                   â”‚
    â”‚  â€¢ kubernetes.io/gce-pd (GCP Persistent Disk)                        â”‚
    â”‚  â€¢ kubernetes.io/azure-disk (Azure Disk)                             â”‚
    â”‚  â€¢ rancher.io/local-path (Local path)                                â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
CHAPTER SUMMARY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  STORAGE - KEY TAKEAWAYS                                              â”‚
    â”‚                                                                         â”‚
    â”‚  COMPONENTS                                                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
    â”‚  â€¢ PV: Actual storage resource                                       â”‚
    â”‚  â€¢ PVC: Request for storage                                          â”‚
    â”‚  â€¢ StorageClass: Template for dynamic provisioning                  â”‚
    â”‚                                                                         â”‚
    â”‚  ACCESS MODES                                                          â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
    â”‚  â€¢ RWO: Single node read-write                                       â”‚
    â”‚  â€¢ ROX: Multiple nodes read-only                                     â”‚
    â”‚  â€¢ RWX: Multiple nodes read-write                                    â”‚
    â”‚                                                                         â”‚
    â”‚  DYNAMIC PROVISIONING                                                  â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
    â”‚  StorageClass + PVC = automatic PV creation                          â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                              END OF CHAPTER 7
================================================================================

