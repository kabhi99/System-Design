================================================================================
         UBER SYSTEM DESIGN
         Chapter 5: Dynamic Pricing and Surge
================================================================================

Dynamic pricing (surge) is controversial but essential for balancing
supply and demand. This chapter covers how surge pricing works, its
algorithms, and implementation challenges.


================================================================================
SECTION 5.1: WHY DYNAMIC PRICING?
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE SUPPLY-DEMAND PROBLEM                                            â”‚
    â”‚                                                                         â”‚
    â”‚  Normal conditions:                                                    â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
    â”‚  Riders: 1,000/hour      Drivers: 1,200 available                    â”‚
    â”‚  â†’ Everyone gets a ride quickly                                      â”‚
    â”‚                                                                         â”‚
    â”‚  High demand (concert ends, rain, New Year's Eve):                   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
    â”‚  Riders: 5,000/hour      Drivers: 1,200 available                    â”‚
    â”‚  â†’ Wait times spike to 30+ minutes                                   â”‚
    â”‚  â†’ Rider satisfaction drops                                          â”‚
    â”‚  â†’ Drivers overwhelmed                                               â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  HOW SURGE HELPS                                                       â”‚
    â”‚                                                                         â”‚
    â”‚  1. DEMAND REDUCTION                                                   â”‚
    â”‚     â€¢ Higher prices â†’ some riders wait or use alternatives          â”‚
    â”‚     â€¢ Demand drops from 5,000 to 3,000                               â”‚
    â”‚                                                                         â”‚
    â”‚  2. SUPPLY INCREASE                                                    â”‚
    â”‚     â€¢ Higher earnings â†’ more drivers come online                    â”‚
    â”‚     â€¢ Drivers in nearby areas drive to surge zone                   â”‚
    â”‚     â€¢ Supply increases from 1,200 to 2,000                          â”‚
    â”‚                                                                         â”‚
    â”‚  3. MARKET EQUILIBRIUM                                                 â”‚
    â”‚     â€¢ Price adjusts until supply â‰ˆ demand                           â”‚
    â”‚     â€¢ Wait times stay reasonable (5-10 min)                         â”‚
    â”‚                                                                         â”‚
    â”‚  WITHOUT SURGE:                    WITH SURGE:                        â”‚
    â”‚                                                                         â”‚
    â”‚  Demand: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     Demand: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               â”‚
    â”‚  Supply: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 Supply: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚
    â”‚          â†‘                                â†‘                           â”‚
    â”‚          Gap (30 min wait)                Balanced (5 min)           â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.2: SURGE MULTIPLIER CALCULATION
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  BASIC FORMULA                                                         â”‚
    â”‚                                                                         â”‚
    â”‚  surge_multiplier = f(demand, supply)                                 â”‚
    â”‚                                                                         â”‚
    â”‚  Simple approach:                                                      â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  demand_supply_ratio = active_requests / available_drivers           â”‚
    â”‚                                                                         â”‚
    â”‚  if ratio < 1.0:                                                      â”‚
    â”‚      surge = 1.0  (no surge)                                         â”‚
    â”‚  elif ratio < 2.0:                                                    â”‚
    â”‚      surge = 1.0 + (ratio - 1.0) * 0.5  (1.0x to 1.5x)             â”‚
    â”‚  elif ratio < 4.0:                                                    â”‚
    â”‚      surge = 1.5 + (ratio - 2.0) * 0.5  (1.5x to 2.5x)             â”‚
    â”‚  else:                                                                 â”‚
    â”‚      surge = min(ratio * 0.6, 5.0)  (cap at 5.0x)                   â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  METRICS USED                                                          â”‚
    â”‚                                                                         â”‚
    â”‚  DEMAND INDICATORS:                                                    â”‚
    â”‚  â€¢ Active ride requests in area                                      â”‚
    â”‚  â€¢ App opens (riders checking prices)                                â”‚
    â”‚  â€¢ Predicted demand (ML model)                                       â”‚
    â”‚  â€¢ Event data (concert ending, game ending)                         â”‚
    â”‚                                                                         â”‚
    â”‚  SUPPLY INDICATORS:                                                    â”‚
    â”‚  â€¢ Available drivers in area                                         â”‚
    â”‚  â€¢ Drivers en route to area                                          â”‚
    â”‚  â€¢ Average ETA in area                                               â”‚
    â”‚  â€¢ Driver acceptance rate                                            â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  ADVANCED FORMULA (ML-Based)                                          â”‚
    â”‚                                                                         â”‚
    â”‚  def calculate_surge(zone_id, current_time):                         â”‚
    â”‚      # Get real-time metrics                                         â”‚
    â”‚      requests = count_active_requests(zone_id)                       â”‚
    â”‚      drivers = count_available_drivers(zone_id)                      â”‚
    â”‚      avg_eta = get_average_eta(zone_id)                              â”‚
    â”‚      acceptance_rate = get_acceptance_rate(zone_id)                  â”‚
    â”‚                                                                         â”‚
    â”‚      # Historical patterns                                            â”‚
    â”‚      historical_surge = get_historical_surge(                        â”‚
    â”‚          zone_id,                                                      â”‚
    â”‚          day_of_week=current_time.weekday(),                         â”‚
    â”‚          hour=current_time.hour                                       â”‚
    â”‚      )                                                                 â”‚
    â”‚                                                                         â”‚
    â”‚      # Event adjustments                                              â”‚
    â”‚      events = get_nearby_events(zone_id, current_time)               â”‚
    â”‚      event_factor = calculate_event_impact(events)                   â”‚
    â”‚                                                                         â”‚
    â”‚      # Weather impact                                                 â”‚
    â”‚      weather = get_weather(zone_id)                                  â”‚
    â”‚      weather_factor = 1.0 + (0.3 if weather.is_raining else 0)      â”‚
    â”‚                                                                         â”‚
    â”‚      # Combine factors                                                â”‚
    â”‚      base_surge = max(1.0, requests / max(drivers, 1))              â”‚
    â”‚      eta_factor = 1.0 + max(0, (avg_eta - 5) / 10)  # penalize >5minâ”‚
    â”‚                                                                         â”‚
    â”‚      surge = (                                                         â”‚
    â”‚          base_surge *                                                  â”‚
    â”‚          historical_surge *                                           â”‚
    â”‚          event_factor *                                               â”‚
    â”‚          weather_factor *                                             â”‚
    â”‚          (1.0 / acceptance_rate)  # low acceptance = high demand    â”‚
    â”‚      )                                                                 â”‚
    â”‚                                                                         â”‚
    â”‚      # Apply caps and smoothing                                       â”‚
    â”‚      return smooth_surge(zone_id, min(surge, MAX_SURGE))             â”‚
    â”‚                                                                         â”‚
    â”‚  MAX_SURGE typically 5.0x to 8.0x depending on market               â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.3: SURGE ZONES (GEOFENCING)
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHY ZONES?                                                            â”‚
    â”‚                                                                         â”‚
    â”‚  Surge varies by location:                                            â”‚
    â”‚  â€¢ Airport surging, downtown normal                                  â”‚
    â”‚  â€¢ Stadium area surging, suburbs normal                              â”‚
    â”‚                                                                         â”‚
    â”‚  Need to divide city into zones for localized pricing.               â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  ZONE DEFINITION APPROACHES                                           â”‚
    â”‚                                                                         â”‚
    â”‚  1. HEXAGONAL GRID (H3 - Uber's choice)                              â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                â”‚
    â”‚                                                                         â”‚
    â”‚      _____         _____         _____                                 â”‚
    â”‚     /     \       /     \       /     \                                â”‚
    â”‚    / 1.5x  \_____/ 1.0x  \_____/ 2.0x  \                              â”‚
    â”‚    \       /     \       /     \       /                              â”‚
    â”‚     \_____/ 1.2x  \_____/ 1.0x  \_____/                               â”‚
    â”‚     /     \       /     \       /     \                                â”‚
    â”‚    / 1.8x  \_____/ 1.3x  \_____/ 1.0x  \                              â”‚
    â”‚    \       /     \       /     \       /                              â”‚
    â”‚     \_____/       \_____/       \_____/                               â”‚
    â”‚                                                                         â”‚
    â”‚  WHY HEXAGONS?                                                         â”‚
    â”‚  â€¢ All neighbors equidistant (unlike squares)                        â”‚
    â”‚  â€¢ No diagonal ambiguity                                             â”‚
    â”‚  â€¢ Smoother zone transitions                                         â”‚
    â”‚  â€¢ 6 neighbors vs 4/8 for squares                                    â”‚
    â”‚                                                                         â”‚
    â”‚  H3 library provides hierarchical hex grid                           â”‚
    â”‚  Resolution 7 â‰ˆ 5kmÂ² cells (good for surge)                         â”‚
    â”‚                                                                         â”‚
    â”‚  2. DYNAMIC CLUSTERING                                                â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  Instead of fixed grid, cluster based on demand:                     â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ K-means clustering on ride requests                               â”‚
    â”‚  â€¢ Zones grow/shrink based on activity                              â”‚
    â”‚  â€¢ More granular in dense areas                                      â”‚
    â”‚                                                                         â”‚
    â”‚  More complex, harder to explain to users.                           â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.4: SURGE PRICING SERVICE
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SURGE SERVICE ARCHITECTURE                                           â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚              Metrics Aggregator                         â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  (Collects demand/supply every 30 seconds)             â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚       â”‚                    â”‚                    â”‚              â”‚  â”‚
    â”‚  â”‚       â–¼                    â–¼                    â–¼              â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
    â”‚  â”‚  â”‚ Request  â”‚        â”‚ Driver   â”‚        â”‚ ETA      â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ Counter  â”‚        â”‚ Counter  â”‚        â”‚ Service  â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚          â”‚        â”‚          â”‚        â”‚          â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ Requests â”‚        â”‚ Availableâ”‚        â”‚ Avg ETA  â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ per zone â”‚        â”‚ per zone â”‚        â”‚ per zone â”‚         â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
    â”‚  â”‚       â”‚                    â”‚                    â”‚              â”‚  â”‚
    â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
    â”‚  â”‚                            â”‚                                    â”‚  â”‚
    â”‚  â”‚                            â–¼                                    â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚              Surge Calculator                           â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  (Runs every 1-2 minutes)                              â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Calculate surge for each zone                       â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Apply smoothing                                     â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Validate against caps                               â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚                            â”‚                                    â”‚  â”‚
    â”‚  â”‚                            â–¼                                    â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚              Surge Store (Redis)                        â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  Key: surge:{zone_id}                                  â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  Value: { multiplier, updated_at, expires_at }         â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  TTL: 5 minutes                                        â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚                            â”‚                                    â”‚  â”‚
    â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
    â”‚  â”‚       â–¼                    â–¼                    â–¼              â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
    â”‚  â”‚  â”‚ Rider    â”‚        â”‚ Pricing  â”‚        â”‚ Driver   â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ App      â”‚        â”‚ Service  â”‚        â”‚ App      â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚          â”‚        â”‚          â”‚        â”‚          â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ Show     â”‚        â”‚ Apply to â”‚        â”‚ Show     â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ surge on â”‚        â”‚ fare     â”‚        â”‚ surge    â”‚         â”‚  â”‚
    â”‚  â”‚  â”‚ map      â”‚        â”‚ estimate â”‚        â”‚ zones    â”‚         â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.5: FARE CALCULATION
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  FARE COMPONENTS                                                       â”‚
    â”‚                                                                         â”‚
    â”‚  fare = base_fare                                                      â”‚
    â”‚       + (distance_rate Ã— distance_km)                                 â”‚
    â”‚       + (time_rate Ã— duration_minutes)                                â”‚
    â”‚       + booking_fee                                                    â”‚
    â”‚       + tolls                                                          â”‚
    â”‚       + airport_fee                                                    â”‚
    â”‚                                                                         â”‚
    â”‚  WITH SURGE:                                                           â”‚
    â”‚  fare = (base_fare + distance + time) Ã— surge_multiplier             â”‚
    â”‚       + booking_fee  (not surged)                                     â”‚
    â”‚       + tolls        (not surged)                                     â”‚
    â”‚       + fees         (not surged)                                     â”‚
    â”‚                                                                         â”‚
    â”‚  EXAMPLE:                                                              â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
    â”‚  Base fare: $2.50                                                     â”‚
    â”‚  Distance: 5 km Ã— $1.50/km = $7.50                                   â”‚
    â”‚  Time: 15 min Ã— $0.30/min = $4.50                                    â”‚
    â”‚  Subtotal: $14.50                                                     â”‚
    â”‚                                                                         â”‚
    â”‚  Surge: 1.8x                                                          â”‚
    â”‚  Surged subtotal: $14.50 Ã— 1.8 = $26.10                              â”‚
    â”‚                                                                         â”‚
    â”‚  Booking fee: $2.00                                                   â”‚
    â”‚  Total: $28.10                                                        â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  FARE ESTIMATION                                                       â”‚
    â”‚                                                                         â”‚
    â”‚  def estimate_fare(pickup, dropoff, ride_type):                      â”‚
    â”‚      # Get route                                                      â”‚
    â”‚      route = routing_service.get_route(pickup, dropoff)              â”‚
    â”‚      distance_km = route.distance / 1000                              â”‚
    â”‚      duration_min = route.duration / 60                               â”‚
    â”‚                                                                         â”‚
    â”‚      # Get rates for ride type (UberX, UberXL, etc.)                â”‚
    â”‚      rates = get_rates(ride_type, pickup.city)                       â”‚
    â”‚                                                                         â”‚
    â”‚      # Calculate base fare                                            â”‚
    â”‚      base = rates.base_fare                                           â”‚
    â”‚      distance_charge = distance_km * rates.per_km                    â”‚
    â”‚      time_charge = duration_min * rates.per_minute                   â”‚
    â”‚      subtotal = base + distance_charge + time_charge                 â”‚
    â”‚                                                                         â”‚
    â”‚      # Apply minimum fare                                             â”‚
    â”‚      subtotal = max(subtotal, rates.minimum_fare)                    â”‚
    â”‚                                                                         â”‚
    â”‚      # Get surge                                                      â”‚
    â”‚      zone = get_zone(pickup)                                          â”‚
    â”‚      surge = surge_service.get_surge(zone)                           â”‚
    â”‚                                                                         â”‚
    â”‚      # Apply surge                                                    â”‚
    â”‚      surged_subtotal = subtotal * surge                              â”‚
    â”‚                                                                         â”‚
    â”‚      # Add fixed fees                                                 â”‚
    â”‚      total = surged_subtotal + rates.booking_fee                     â”‚
    â”‚                                                                         â”‚
    â”‚      return FareEstimate(                                              â”‚
    â”‚          low=total * 0.9,   # -10% buffer                            â”‚
    â”‚          high=total * 1.1,  # +10% buffer                            â”‚
    â”‚          surge=surge                                                   â”‚
    â”‚      )                                                                 â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.6: SURGE SMOOTHING AND UX
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHY SMOOTHING?                                                        â”‚
    â”‚                                                                         â”‚
    â”‚  Problem: Raw surge is volatile.                                      â”‚
    â”‚  â€¢ 1.5x â†’ 2.3x â†’ 1.8x â†’ 2.1x (every 30 seconds)                    â”‚
    â”‚  â€¢ Confusing for riders                                              â”‚
    â”‚  â€¢ "I just checked and it was cheaper!"                             â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  SMOOTHING TECHNIQUES                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  1. MOVING AVERAGE                                                     â”‚
    â”‚     smooth_surge = 0.7 * current_surge + 0.3 * previous_surge       â”‚
    â”‚                                                                         â”‚
    â”‚  2. STEP INCREMENTS                                                    â”‚
    â”‚     Surge only changes in 0.25x steps                                â”‚
    â”‚     1.0 â†’ 1.25 â†’ 1.5 â†’ 1.75 â†’ 2.0 ...                              â”‚
    â”‚                                                                         â”‚
    â”‚  3. MINIMUM DURATION                                                   â”‚
    â”‚     Surge stays at level for at least 2 minutes                      â”‚
    â”‚     Can't jump from 1.5x to 2.5x instantly                          â”‚
    â”‚                                                                         â”‚
    â”‚  4. HYSTERESIS                                                         â”‚
    â”‚     Surge goes UP faster than DOWN                                   â”‚
    â”‚     (Incentivize drivers to come online)                             â”‚
    â”‚                                                                         â”‚
    â”‚     if new_surge > current_surge:                                    â”‚
    â”‚         # Quick ramp up                                               â”‚
    â”‚         return current_surge + min(0.5, new_surge - current_surge)  â”‚
    â”‚     else:                                                              â”‚
    â”‚         # Slow ramp down                                              â”‚
    â”‚         return current_surge - min(0.25, current_surge - new_surge) â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  USER EXPERIENCE                                                       â”‚
    â”‚                                                                         â”‚
    â”‚  1. UPFRONT PRICING                                                    â”‚
    â”‚     Show final price, not multiplier                                 â”‚
    â”‚     "$28.50" instead of "2.3x surge"                                â”‚
    â”‚     Less confusion, more predictable                                  â”‚
    â”‚                                                                         â”‚
    â”‚  2. SURGE CONFIRMATION                                                 â”‚
    â”‚     "Prices are higher due to increased demand"                      â”‚
    â”‚     "1.8x - Pay $35.00 instead of $19.44"                           â”‚
    â”‚     User must confirm before booking                                  â”‚
    â”‚                                                                         â”‚
    â”‚  3. WAIT FOR LOWER PRICE                                              â”‚
    â”‚     "Surge is expected to drop in ~10 minutes"                       â”‚
    â”‚     "Notify me when prices drop"                                     â”‚
    â”‚                                                                         â”‚
    â”‚  4. HEAT MAP                                                           â”‚
    â”‚     Show riders where surge is high/low                              â”‚
    â”‚     "Walk 2 blocks for 20% cheaper ride"                            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5.7: DRIVER INCENTIVES
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  SURGE NOTIFICATION TO DRIVERS                                        â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Driver App Screen:                                           â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
    â”‚  â”‚   â”‚                                                       â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚   ğŸ“ Surge Area Nearby!                              â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚                                                       â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚   Downtown (2.3x)         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  2.3x  â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚   Airport (1.8x)          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       1.8x  â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚   Stadium (3.0x)          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3.0x  â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚                                                       â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚   ğŸš— Drive to Stadium to earn 3x on next trip       â”‚    â”‚  â”‚
    â”‚  â”‚   â”‚                                                       â”‚    â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  DRIVER EARNINGS                                                       â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
    â”‚                                                                         â”‚
    â”‚  Base trip: Driver earns $15                                         â”‚
    â”‚  With 2.0x surge: Driver earns $15 Ã— 2.0 = $30                      â”‚
    â”‚                                                                         â”‚
    â”‚  (Platform fee applies to base, not surge in some markets)           â”‚
    â”‚                                                                         â”‚
    â”‚  QUESTS AND BONUSES                                                    â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
    â”‚                                                                         â”‚
    â”‚  In addition to surge:                                                â”‚
    â”‚  â€¢ "Complete 10 trips, earn $50 bonus"                              â”‚
    â”‚  â€¢ "Drive during Friday 5-9 PM, earn 1.5x on all trips"            â”‚
    â”‚  â€¢ "Stay in surge zone for 30 min, guaranteed $X"                   â”‚
    â”‚                                                                         â”‚
    â”‚  These incentives are pre-calculated based on demand predictions.   â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
CHAPTER SUMMARY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DYNAMIC PRICING - KEY TAKEAWAYS                                      â”‚
    â”‚                                                                         â”‚
    â”‚  PURPOSE                                                               â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
    â”‚  â€¢ Balance supply and demand                                         â”‚
    â”‚  â€¢ Reduce wait times during high demand                              â”‚
    â”‚  â€¢ Incentivize drivers to high-demand areas                          â”‚
    â”‚                                                                         â”‚
    â”‚  CALCULATION                                                           â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
    â”‚  â€¢ Base: demand/supply ratio                                         â”‚
    â”‚  â€¢ Adjusted by: historical patterns, weather, events, ETA           â”‚
    â”‚  â€¢ Capped (typically 5-8x max)                                       â”‚
    â”‚                                                                         â”‚
    â”‚  ZONES                                                                 â”‚
    â”‚  â”€â”€â”€â”€â”€                                                                 â”‚
    â”‚  â€¢ Hexagonal grid (H3) for uniform zones                            â”‚
    â”‚  â€¢ Surge calculated per zone every 1-2 minutes                      â”‚
    â”‚  â€¢ Stored in Redis for fast lookup                                   â”‚
    â”‚                                                                         â”‚
    â”‚  SMOOTHING                                                             â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
    â”‚  â€¢ Moving average                                                    â”‚
    â”‚  â€¢ Step increments (0.25x)                                          â”‚
    â”‚  â€¢ Hysteresis (up fast, down slow)                                  â”‚
    â”‚                                                                         â”‚
    â”‚  INTERVIEW TIP                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
    â”‚  Explain the economics (supply/demand balance).                      â”‚
    â”‚  Discuss zone definition (why hexagons).                             â”‚
    â”‚  Address UX (smoothing, upfront pricing).                            â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                              END OF CHAPTER 5
================================================================================

