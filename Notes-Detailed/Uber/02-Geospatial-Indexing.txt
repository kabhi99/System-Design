================================================================================
         UBER SYSTEM DESIGN
         Chapter 2: Geospatial Indexing and Location Services
================================================================================

The ability to efficiently query "find all drivers within X km" is the
core challenge in ride-hailing systems. This chapter covers geospatial
indexing techniques and location service design.


================================================================================
SECTION 2.1: THE GEOSPATIAL PROBLEM
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  CORE QUERIES WE NEED TO ANSWER                                       â”‚
    â”‚                                                                         â”‚
    â”‚  1. "Find all drivers within 3km of this point"                       â”‚
    â”‚  2. "Find the 10 nearest drivers to this location"                    â”‚
    â”‚  3. "Update driver location" (250,000 times/second!)                  â”‚
    â”‚  4. "Calculate distance between two points"                           â”‚
    â”‚  5. "Estimate travel time between two points"                         â”‚
    â”‚                                                                         â”‚
    â”‚  THE NAIVE APPROACH (And why it fails)                                â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
    â”‚                                                                         â”‚
    â”‚  SELECT * FROM drivers                                                â”‚
    â”‚  WHERE status = 'available'                                           â”‚
    â”‚    AND SQRT(POW(lat - :rider_lat, 2) + POW(lng - :rider_lng, 2))     â”‚
    â”‚        < :radius;                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  PROBLEMS:                                                             â”‚
    â”‚  â€¢ Full table scan (1 million rows!)                                 â”‚
    â”‚  â€¢ Can't use indexes (function on column)                            â”‚
    â”‚  â€¢ Too slow for real-time (seconds, not milliseconds)                â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 2.2: GEOSPATIAL INDEXING TECHNIQUES
================================================================================

TECHNIQUE 1: GEOHASH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  GEOHASH                                                               â”‚
    â”‚                                                                         â”‚
    â”‚  Geohash encodes a geographic location into a short string.           â”‚
    â”‚  Nearby locations share common prefixes.                              â”‚
    â”‚                                                                         â”‚
    â”‚  EXAMPLE:                                                              â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
    â”‚  San Francisco: 37.7749, -122.4194 â†’ "9q8yyk"                        â”‚
    â”‚  Nearby point:  37.7750, -122.4195 â†’ "9q8yym"                        â”‚
    â”‚                                       ^^^^^^                           â”‚
    â”‚                                       Same prefix!                     â”‚
    â”‚                                                                         â”‚
    â”‚  PRECISION LEVELS:                                                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Length â”‚ Cell Width    â”‚ Cell Height   â”‚ Use Case              â”‚   â”‚
    â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
    â”‚  â”‚   1    â”‚ ~5,000 km     â”‚ ~5,000 km     â”‚ Continent             â”‚   â”‚
    â”‚  â”‚   2    â”‚ ~1,250 km     â”‚ ~625 km       â”‚ Large country         â”‚   â”‚
    â”‚  â”‚   3    â”‚ ~156 km       â”‚ ~156 km       â”‚ State                 â”‚   â”‚
    â”‚  â”‚   4    â”‚ ~39 km        â”‚ ~19.5 km      â”‚ City                  â”‚   â”‚
    â”‚  â”‚   5    â”‚ ~4.9 km       â”‚ ~4.9 km       â”‚ Neighborhood          â”‚   â”‚
    â”‚  â”‚   6    â”‚ ~1.2 km       â”‚ ~609 m        â”‚ Street                â”‚   â”‚
    â”‚  â”‚   7    â”‚ ~153 m        â”‚ ~153 m        â”‚ Building              â”‚   â”‚
    â”‚  â”‚   8    â”‚ ~38 m         â”‚ ~19 m         â”‚ House                 â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                                                                         â”‚
    â”‚  HOW TO USE FOR PROXIMITY SEARCH:                                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
    â”‚                                                                         â”‚
    â”‚  1. Calculate geohash for rider's location (precision 6)             â”‚
    â”‚  2. Find all 8 neighboring cells (to handle edge cases)              â”‚
    â”‚  3. Query drivers in all 9 cells                                     â”‚
    â”‚  4. Calculate actual distance, filter to radius                      â”‚
    â”‚                                                                         â”‚
    â”‚  SELECT * FROM drivers                                                â”‚
    â”‚  WHERE geohash LIKE '9q8yy%'  -- Cell and neighbors                  â”‚
    â”‚     OR geohash LIKE '9q8yym%'                                        â”‚
    â”‚     OR geohash LIKE '9q8yyn%'                                        â”‚
    â”‚     ...;                                                               â”‚
    â”‚                                                                         â”‚
    â”‚  PROS:                                                                 â”‚
    â”‚  âœ“ Simple string prefix matching                                     â”‚
    â”‚  âœ“ Can use standard B-tree index                                     â”‚
    â”‚  âœ“ Easy to understand                                                â”‚
    â”‚                                                                         â”‚
    â”‚  CONS:                                                                 â”‚
    â”‚  âœ— Edge effects (need to check neighbors)                            â”‚
    â”‚  âœ— Uneven cell sizes at different latitudes                         â”‚
    â”‚  âœ— Multiple queries for neighbors                                    â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TECHNIQUE 2: QUADTREE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  QUADTREE                                                              â”‚
    â”‚                                                                         â”‚
    â”‚  Recursively divide space into 4 quadrants.                           â”‚
    â”‚  More points in an area â†’ more subdivisions.                         â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Initial space:           After subdivision:                   â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
    â”‚  â”‚  â”‚                 â”‚      â”‚   NW   â”‚   NE   â”‚                  â”‚  â”‚
    â”‚  â”‚  â”‚                 â”‚      â”‚ (empty)â”‚ (dense)â”‚                  â”‚  â”‚
    â”‚  â”‚  â”‚    â— â— â—        â”‚  â†’   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚  â”‚
    â”‚  â”‚  â”‚  â— â— â— â—        â”‚      â”‚   SW   â”‚   SE   â”‚                  â”‚  â”‚
    â”‚  â”‚  â”‚    â— â—          â”‚      â”‚(sparse)â”‚(sparse)â”‚                  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  NE quadrant is dense â†’ subdivide further:                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚  â”‚
    â”‚  â”‚  â”‚        â”‚        â”‚                                           â”‚  â”‚
    â”‚  â”‚  â”‚   NW   â”‚â—  NE   â”‚  (recursively until threshold)           â”‚  â”‚
    â”‚  â”‚  â”‚        â”‚        â”‚                                           â”‚  â”‚
    â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                           â”‚  â”‚
    â”‚  â”‚  â”‚        â”‚â— â—     â”‚                                           â”‚  â”‚
    â”‚  â”‚  â”‚   SW   â”‚   SE   â”‚                                           â”‚  â”‚
    â”‚  â”‚  â”‚        â”‚â— â— â—   â”‚                                           â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  PROXIMITY SEARCH:                                                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
    â”‚  1. Find the quadrant containing the query point                     â”‚
    â”‚  2. Check if quadrant overlaps with search radius                    â”‚
    â”‚  3. Recursively check overlapping quadrants                          â”‚
    â”‚  4. Return points within radius                                      â”‚
    â”‚                                                                         â”‚
    â”‚  PROS:                                                                 â”‚
    â”‚  âœ“ Adapts to data density (more detail where needed)                â”‚
    â”‚  âœ“ Efficient for non-uniform distributions                          â”‚
    â”‚                                                                         â”‚
    â”‚  CONS:                                                                 â”‚
    â”‚  âœ— More complex implementation                                       â”‚
    â”‚  âœ— Rebalancing needed when points move                              â”‚
    â”‚  âœ— Memory overhead for tree structure                               â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TECHNIQUE 3: S2 GEOMETRY (Google's Solution)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  S2 GEOMETRY LIBRARY                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  Projects Earth onto a cube, then subdivides each face.              â”‚
    â”‚  Used by Google Maps, Uber, Foursquare.                              â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚        Earth                    Cube Projection                â”‚  â”‚
    â”‚  â”‚          ğŸŒ             â†’       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
    â”‚  â”‚                                â”‚    â”Œâ”€â”€â”€â”  â”‚                    â”‚  â”‚
    â”‚  â”‚                                â”‚    â”‚   â”‚  â”‚                    â”‚  â”‚
    â”‚  â”‚                                â”‚    â””â”€â”€â”€â”˜  â”‚                    â”‚  â”‚
    â”‚  â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Each face divided into cells (like quadtree but on sphere)   â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  S2 CELL IDs:                                                          â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
    â”‚  â€¢ 64-bit integer uniquely identifies each cell                      â”‚
    â”‚  â€¢ Hierarchical: parent/child relationship encoded                   â”‚
    â”‚  â€¢ 30 levels (level 30 = ~1 cmÂ² cells)                              â”‚
    â”‚                                                                         â”‚
    â”‚  Level    â”‚ Avg Area     â”‚ Use Case                                   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
    â”‚  0        â”‚ 85M kmÂ²      â”‚ Face of cube (1/6 of Earth)               â”‚
    â”‚  4        â”‚ 300K kmÂ²     â”‚ Large country                              â”‚
    â”‚  12       â”‚ 3 kmÂ²        â”‚ City district                              â”‚
    â”‚  16       â”‚ 10,000 mÂ²    â”‚ City block                                 â”‚
    â”‚  23       â”‚ 1 mÂ²         â”‚ Room                                       â”‚
    â”‚  30       â”‚ 1 cmÂ²        â”‚ Maximum precision                          â”‚
    â”‚                                                                         â”‚
    â”‚  COVERING:                                                             â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
    â”‚  For any shape (circle, polygon), S2 finds minimum set of cells     â”‚
    â”‚  that cover it completely.                                           â”‚
    â”‚                                                                         â”‚
    â”‚  "3km radius around point" â†’ [cell1, cell2, cell3, ...]             â”‚
    â”‚                                                                         â”‚
    â”‚  PROS:                                                                 â”‚
    â”‚  âœ“ Uniform cell sizes globally                                       â”‚
    â”‚  âœ“ Efficient range queries                                           â”‚
    â”‚  âœ“ Works with any shape (not just circles)                          â”‚
    â”‚  âœ“ Battle-tested at Google/Uber scale                               â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 2.3: UBER'S LOCATION SERVICE ARCHITECTURE
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  LOCATION SERVICE ARCHITECTURE                                        â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Driver Apps (millions)                                        â”‚  â”‚
    â”‚  â”‚       â”‚ Location updates (250K/sec)                            â”‚  â”‚
    â”‚  â”‚       â–¼                                                         â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚              Load Balancer                              â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚       â”‚                                                         â”‚  â”‚
    â”‚  â”‚       â–¼                                                         â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚         Location Ingestion Service                      â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  (Stateless, horizontally scaled)                       â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Validate location data                               â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Calculate S2 Cell ID                                 â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  - Write to storage                                     â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚       â”‚                    â”‚                                    â”‚  â”‚
    â”‚  â”‚       â–¼                    â–¼                                    â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
    â”‚  â”‚  â”‚    Redis     â”‚    â”‚    Kafka     â”‚                          â”‚  â”‚
    â”‚  â”‚  â”‚ (Current     â”‚    â”‚ (Location    â”‚                          â”‚  â”‚
    â”‚  â”‚  â”‚  locations)  â”‚    â”‚  history)    â”‚                          â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
    â”‚  â”‚       â”‚                    â”‚                                    â”‚  â”‚
    â”‚  â”‚       â”‚                    â–¼                                    â”‚  â”‚
    â”‚  â”‚       â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚
    â”‚  â”‚       â”‚           â”‚  Time-Series â”‚                              â”‚  â”‚
    â”‚  â”‚       â”‚           â”‚  Database    â”‚                              â”‚  â”‚
    â”‚  â”‚       â”‚           â”‚(Trip tracking)â”‚                             â”‚  â”‚
    â”‚  â”‚       â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚
    â”‚  â”‚       â”‚                                                         â”‚  â”‚
    â”‚  â”‚       â–¼                                                         â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚              Query Service                              â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  "Find drivers near this location"                      â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚       â”‚                                                         â”‚  â”‚
    â”‚  â”‚       â–¼                                                         â”‚  â”‚
    â”‚  â”‚  Rider App / Matching Service                                  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


REDIS DATA STRUCTURE FOR LOCATIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  OPTION 1: REDIS GEO COMMANDS                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
    â”‚                                                                         â”‚
    â”‚  Redis has built-in geospatial support!                               â”‚
    â”‚                                                                         â”‚
    â”‚  GEOADD drivers -122.4194 37.7749 "driver_123"                       â”‚
    â”‚  GEOADD drivers -122.4095 37.7849 "driver_456"                       â”‚
    â”‚                                                                         â”‚
    â”‚  GEORADIUS drivers -122.4194 37.7749 3 km WITHDIST                   â”‚
    â”‚  â†’ Returns drivers within 3km with distances                         â”‚
    â”‚                                                                         â”‚
    â”‚  PROS:                                                                 â”‚
    â”‚  âœ“ Built-in, no custom code                                          â”‚
    â”‚  âœ“ Fast (O(N+log(M)) for N results, M total items)                  â”‚
    â”‚                                                                         â”‚
    â”‚  CONS:                                                                 â”‚
    â”‚  âœ— All data in one sorted set (memory bound)                        â”‚
    â”‚  âœ— Can't filter by driver status easily                             â”‚
    â”‚                                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                                                                         â”‚
    â”‚  OPTION 2: SHARDED BY S2 CELL                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                        â”‚
    â”‚                                                                         â”‚
    â”‚  Shard drivers by their S2 cell ID.                                   â”‚
    â”‚                                                                         â”‚
    â”‚  Key: cell:{s2_cell_id}                                               â”‚
    â”‚  Value: Set of driver IDs in that cell                                â”‚
    â”‚                                                                         â”‚
    â”‚  cell:89c25a  â†’ {driver_123, driver_456, driver_789}                 â”‚
    â”‚  cell:89c25b  â†’ {driver_111, driver_222}                             â”‚
    â”‚                                                                         â”‚
    â”‚  Each driver also has:                                                â”‚
    â”‚  driver:{driver_id}:location â†’ { lat, lng, status, timestamp }       â”‚
    â”‚                                                                         â”‚
    â”‚  QUERY FLOW:                                                           â”‚
    â”‚  1. Calculate S2 covering cells for search area                      â”‚
    â”‚  2. For each cell, get driver IDs from Redis set                     â”‚
    â”‚  3. Lookup each driver's full location                               â”‚
    â”‚  4. Filter by status (available)                                     â”‚
    â”‚  5. Calculate exact distance, return nearest                         â”‚
    â”‚                                                                         â”‚
    â”‚  UPDATE FLOW:                                                          â”‚
    â”‚  1. Receive new location for driver                                  â”‚
    â”‚  2. Calculate new S2 cell                                            â”‚
    â”‚  3. If cell changed:                                                 â”‚
    â”‚     - SREM old_cell driver_id                                        â”‚
    â”‚     - SADD new_cell driver_id                                        â”‚
    â”‚  4. Update driver:{id}:location                                      â”‚
    â”‚                                                                         â”‚
    â”‚  PROS:                                                                 â”‚
    â”‚  âœ“ Can filter by any attribute (status, vehicle type)               â”‚
    â”‚  âœ“ Scales better (smaller sets)                                      â”‚
    â”‚  âœ“ Can shard across multiple Redis instances                        â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 2.4: LOCATION UPDATE FLOW
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DRIVER LOCATION UPDATE SEQUENCE                                      â”‚
    â”‚                                                                         â”‚
    â”‚  Driver App         Ingestion         Redis            Kafka          â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚ POST /location â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚ {lat,lng,ts}   â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ Validate       â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ Calculate S2   â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ HSET driver:123â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ If cell changed:               â”‚             â”‚
    â”‚      â”‚                â”‚ SREM old_cell  â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ SADD new_cell  â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚ Publish for history            â”‚             â”‚
    â”‚      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚    200 OK      â”‚                â”‚                â”‚             â”‚
    â”‚      â”‚                â”‚                â”‚                â”‚             â”‚
    â”‚                                                                         â”‚
    â”‚  OPTIMIZATIONS:                                                        â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
    â”‚  â€¢ Batch updates (driver sends every 4s, but can batch in server)   â”‚
    â”‚  â€¢ Skip update if location hasn't changed much (<10m)               â”‚
    â”‚  â€¢ Use UDP instead of HTTP for lower latency                        â”‚
    â”‚  â€¢ Connection pooling to Redis                                       â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 2.5: NEARBY DRIVERS QUERY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  FIND NEARBY DRIVERS ALGORITHM                                        â”‚
    â”‚                                                                         â”‚
    â”‚  public List<Driver> findNearbyDrivers(                               â”‚
    â”‚      double lat, double lng, double radiusKm, int limit               â”‚
    â”‚  ) {                                                                   â”‚
    â”‚      // 1. Calculate S2 cells covering the search area               â”‚
    â”‚      S2Point center = S2LatLng.fromDegrees(lat, lng).toPoint();      â”‚
    â”‚      S2Cap searchArea = S2Cap.fromAxisArea(                          â”‚
    â”‚          center,                                                       â”‚
    â”‚          radiusKm * radiusKm / EARTH_RADIUS_KM_SQ                    â”‚
    â”‚      );                                                                â”‚
    â”‚                                                                         â”‚
    â”‚      S2RegionCoverer coverer = new S2RegionCoverer();                â”‚
    â”‚      coverer.setMaxLevel(12);  // ~3km cells                         â”‚
    â”‚      coverer.setMaxCells(20);                                         â”‚
    â”‚      List<S2CellId> coveringCells = coverer.getCovering(searchArea);â”‚
    â”‚                                                                         â”‚
    â”‚      // 2. Query drivers in each cell                                â”‚
    â”‚      Set<String> candidateDriverIds = new HashSet<>();               â”‚
    â”‚      for (S2CellId cellId : coveringCells) {                         â”‚
    â”‚          Set<String> driversInCell = redis.smembers(                 â”‚
    â”‚              "cell:" + cellId.toToken()                              â”‚
    â”‚          );                                                            â”‚
    â”‚          candidateDriverIds.addAll(driversInCell);                   â”‚
    â”‚      }                                                                 â”‚
    â”‚                                                                         â”‚
    â”‚      // 3. Get full location data for candidates                     â”‚
    â”‚      List<Driver> candidates = new ArrayList<>();                    â”‚
    â”‚      for (String driverId : candidateDriverIds) {                    â”‚
    â”‚          Map<String, String> data = redis.hgetall(                   â”‚
    â”‚              "driver:" + driverId + ":location"                      â”‚
    â”‚          );                                                            â”‚
    â”‚          if ("available".equals(data.get("status"))) {              â”‚
    â”‚              candidates.add(parseDriver(driverId, data));            â”‚
    â”‚          }                                                             â”‚
    â”‚      }                                                                 â”‚
    â”‚                                                                         â”‚
    â”‚      // 4. Calculate actual distance, sort, return top N            â”‚
    â”‚      return candidates.stream()                                       â”‚
    â”‚          .map(d -> new DriverWithDistance(d, calculateDistance(      â”‚
    â”‚              lat, lng, d.getLat(), d.getLng()                        â”‚
    â”‚          )))                                                           â”‚
    â”‚          .filter(d -> d.distance <= radiusKm)                        â”‚
    â”‚          .sorted(Comparator.comparing(d -> d.distance))              â”‚
    â”‚          .limit(limit)                                                 â”‚
    â”‚          .map(d -> d.driver)                                          â”‚
    â”‚          .collect(Collectors.toList());                              â”‚
    â”‚  }                                                                     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
CHAPTER SUMMARY
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  GEOSPATIAL INDEXING - KEY TAKEAWAYS                                  â”‚
    â”‚                                                                         â”‚
    â”‚  INDEXING TECHNIQUES                                                   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
    â”‚  â€¢ Geohash: Simple string prefix, good for basic use                 â”‚
    â”‚  â€¢ Quadtree: Adapts to density, tree structure                       â”‚
    â”‚  â€¢ S2 Geometry: Industry standard, uniform cells                     â”‚
    â”‚                                                                         â”‚
    â”‚  STORAGE                                                               â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
    â”‚  â€¢ Redis for current locations (in-memory speed)                     â”‚
    â”‚  â€¢ Shard by S2 cell for scalability                                  â”‚
    â”‚  â€¢ Kafka for location history (audit, ML)                            â”‚
    â”‚                                                                         â”‚
    â”‚  QUERY FLOW                                                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
    â”‚  1. Calculate covering cells for search area                         â”‚
    â”‚  2. Query drivers in each cell                                       â”‚
    â”‚  3. Filter by status                                                 â”‚
    â”‚  4. Calculate actual distance                                        â”‚
    â”‚  5. Sort and return nearest                                          â”‚
    â”‚                                                                         â”‚
    â”‚  INTERVIEW TIP                                                         â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
    â”‚  Explain why naive SQL doesn't work.                                 â”‚
    â”‚  Draw S2 cell covering for a radius search.                          â”‚
    â”‚  Discuss Redis data structure for updates.                           â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                              END OF CHAPTER 2
================================================================================

