================================================================================
FOOD DELIVERY PLATFORM SYSTEM DESIGN
================================================================================

PART 3: LOCATION TRACKING & DELIVERY PARTNER ASSIGNMENT
================================================================================


================================================================================
SECTION 1: LOCATION SERVICE (THE CRITICAL COMPONENT)
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHY LOCATION IS THE HARDEST PROBLEM                                   â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ 300,000 delivery partners online during peak                       â”‚
    â”‚  â€¢ Location update every 4 seconds                                    â”‚
    â”‚  â€¢ = 75,000 location writes/second                                    â”‚
    â”‚  â€¢ + Thousands of "find nearby partner" queries/second               â”‚
    â”‚  â€¢ + Live tracking for every active order                            â”‚
    â”‚                                                                         â”‚
    â”‚  This is HIGHER throughput than the order service!                    â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  LOCATION DATA FLOW                                                    â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Delivery Partner App                                         â”‚  â”‚
    â”‚  â”‚         â”‚                                                       â”‚  â”‚
    â”‚  â”‚         â”‚ Every 4 seconds:                                     â”‚  â”‚
    â”‚  â”‚         â”‚ PUT /api/partner/location                           â”‚  â”‚
    â”‚  â”‚         â”‚ { lat, lng, timestamp, speed, heading }             â”‚  â”‚
    â”‚  â”‚         â”‚                                                       â”‚  â”‚
    â”‚  â”‚         â–¼                                                       â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚  â”‚
    â”‚  â”‚   â”‚  LOAD BALANCER   â”‚                                        â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚  â”‚
    â”‚  â”‚            â”‚                                                   â”‚  â”‚
    â”‚  â”‚            â–¼                                                   â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚  â”‚
    â”‚  â”‚   â”‚ LOCATION SERVICE â”‚                                        â”‚  â”‚
    â”‚  â”‚   â”‚   (Stateless)    â”‚                                        â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚  â”‚
    â”‚  â”‚            â”‚                                                   â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
    â”‚  â”‚    â”‚               â”‚                                          â”‚  â”‚
    â”‚  â”‚    â–¼               â–¼                                          â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚  â”‚
    â”‚  â”‚  â”‚ Redis â”‚    â”‚  Kafka  â”‚                                     â”‚  â”‚
    â”‚  â”‚  â”‚ (GEO) â”‚    â”‚ (stream)â”‚                                     â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                     â”‚  â”‚
    â”‚  â”‚                    â”‚                                           â”‚  â”‚
    â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚  â”‚
    â”‚  â”‚            â”‚               â”‚                                  â”‚  â”‚
    â”‚  â”‚            â–¼               â–¼                                  â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
    â”‚  â”‚    â”‚  Tracking   â”‚  â”‚   Partner   â”‚                          â”‚  â”‚
    â”‚  â”‚    â”‚  Service    â”‚  â”‚  Analytics  â”‚                          â”‚  â”‚
    â”‚  â”‚    â”‚ (WebSocket) â”‚  â”‚             â”‚                          â”‚  â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
    â”‚  â”‚          â”‚                                                    â”‚  â”‚
    â”‚  â”‚          â–¼                                                    â”‚  â”‚
    â”‚  â”‚    Customer App                                               â”‚  â”‚
    â”‚  â”‚    (Live Map Update)                                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 2: GEOSPATIAL DATA STORAGE
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  OPTION 1: REDIS GEO (Recommended for Partner Location)               â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
    â”‚                                                                         â”‚
    â”‚  Redis has built-in geospatial commands using Geohash internally      â”‚
    â”‚                                                                         â”‚
    â”‚  Store partner location:                                               â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  GEOADD partner:locations <longitude> <latitude> <partner_id>  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Example:                                                       â”‚  â”‚
    â”‚  â”‚  GEOADD partner:locations 77.5946 12.9716 partner_123         â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  Find nearby partners:                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  GEORADIUS partner:locations <lng> <lat> <radius> <unit>       â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Example:                                                       â”‚  â”‚
    â”‚  â”‚  GEORADIUS partner:locations 77.5946 12.9716 3 km             â”‚  â”‚
    â”‚  â”‚    WITHDIST WITHCOORD COUNT 10 ASC                             â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Returns: Partners within 3km, sorted by distance             â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  Advantages:                                                           â”‚
    â”‚  âœ“ Fast O(log N) operations                                          â”‚
    â”‚  âœ“ Built-in distance calculation                                     â”‚
    â”‚  âœ“ No external dependency                                            â”‚
    â”‚  âœ“ 75K writes/second achievable                                      â”‚
    â”‚                                                                         â”‚
    â”‚  Limitations:                                                          â”‚
    â”‚  âœ— Single key (no sharding out of box)                               â”‚
    â”‚  âœ— Memory intensive                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  OPTION 2: GEOHASH SHARDING (For Higher Scale)                        â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  GEOHASH: Encode lat/lng into a string                        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Location: (12.9716, 77.5946) Bangalore                       â”‚  â”‚
    â”‚  â”‚  Geohash: "tdr1xnep0"                                         â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Prefix sharing = nearby locations                            â”‚  â”‚
    â”‚  â”‚  "tdr1xnep0" and "tdr1xnep1" are neighbors                   â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  Geohash Length  â†’  Cell Size                          â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  1 character     â†’  5,000 km Ã— 5,000 km                â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  4 characters    â†’  39 km Ã— 19 km                      â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  5 characters    â†’  5 km Ã— 5 km                        â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  6 characters    â†’  1.2 km Ã— 0.6 km                    â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  7 characters    â†’  150m Ã— 150m                        â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  8 characters    â†’  38m Ã— 19m                          â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  SHARDING BY GEOHASH:                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Use 4-char geohash prefix for sharding                       â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Redis Key: partner:locations:{geohash_prefix}                â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Example:                                                       â”‚  â”‚
    â”‚  â”‚  â€¢ partner:locations:tdr1 (Bangalore area 1)                  â”‚  â”‚
    â”‚  â”‚  â€¢ partner:locations:tdr2 (Bangalore area 2)                  â”‚  â”‚
    â”‚  â”‚  â€¢ partner:locations:w7p9 (Mumbai area)                       â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Benefits:                                                     â”‚  â”‚
    â”‚  â”‚  â€¢ Horizontal scaling by region                               â”‚  â”‚
    â”‚  â”‚  â€¢ Query only relevant shards                                 â”‚  â”‚
    â”‚  â”‚  â€¢ Hot city (Mumbai) doesn't affect others                   â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  OPTION 3: QUADTREE (Alternative)                                     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Divide map into quadrants recursively                        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚  â”‚  â”‚           â”‚           â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚    NW     â”‚    NE     â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚           â”‚           â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   NE-SE   â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚           â”‚           â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚    SW     â”‚    SE     â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚           â”‚           â”‚           â”‚                     â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Keep subdividing until < N partners per cell                 â”‚  â”‚
    â”‚  â”‚  N typically = 100-500                                        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Good for:                                                     â”‚  â”‚
    â”‚  â”‚  â€¢ Non-uniform distribution (cities denser than rural)       â”‚  â”‚
    â”‚  â”‚  â€¢ Custom implementations                                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 3: DELIVERY PARTNER ASSIGNMENT ALGORITHM
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  THE ASSIGNMENT PROBLEM                                                â”‚
    â”‚                                                                         â”‚
    â”‚  When order is placed, find the BEST delivery partner                 â”‚
    â”‚                                                                         â”‚
    â”‚  FACTORS TO CONSIDER:                                                  â”‚
    â”‚  1. Distance from restaurant                                          â”‚
    â”‚  2. Current workload (orders in hand)                                 â”‚
    â”‚  3. Partner rating                                                     â”‚
    â”‚  4. Time since last order (fairness)                                  â”‚
    â”‚  5. Vehicle type (bike for short, car for large orders)              â”‚
    â”‚  6. Partner's preferred areas                                        â”‚
    â”‚  7. Order value (high-value â†’ trusted partners)                      â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  ASSIGNMENT ALGORITHM                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  STEP 1: FIND NEARBY AVAILABLE PARTNERS                        â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  nearby_partners = redis.georadius(                            â”‚  â”‚
    â”‚  â”‚      key="partner:locations",                                  â”‚  â”‚
    â”‚  â”‚      longitude=restaurant.lng,                                 â”‚  â”‚
    â”‚  â”‚      latitude=restaurant.lat,                                  â”‚  â”‚
    â”‚  â”‚      radius=5,  # km                                          â”‚  â”‚
    â”‚  â”‚      unit="km",                                                 â”‚  â”‚
    â”‚  â”‚      count=50,                                                  â”‚  â”‚
    â”‚  â”‚      sort="ASC"  # nearest first                              â”‚  â”‚
    â”‚  â”‚  )                                                              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  STEP 2: FILTER BY AVAILABILITY                                â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  available = []                                                 â”‚  â”‚
    â”‚  â”‚  for partner in nearby_partners:                               â”‚  â”‚
    â”‚  â”‚      status = redis.get(f"partner:{partner.id}:status")       â”‚  â”‚
    â”‚  â”‚      if status == "ONLINE":                                    â”‚  â”‚
    â”‚  â”‚          current_orders = get_active_orders(partner.id)       â”‚  â”‚
    â”‚  â”‚          if current_orders < MAX_CONCURRENT_ORDERS:           â”‚  â”‚
    â”‚  â”‚              available.append(partner)                        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  STEP 3: CALCULATE SCORE FOR EACH PARTNER                     â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  def calculate_score(partner, restaurant, order):             â”‚  â”‚
    â”‚  â”‚      score = 0                                                  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Distance (closer = better) - 40% weight                â”‚  â”‚
    â”‚  â”‚      distance = haversine(partner.loc, restaurant.loc)        â”‚  â”‚
    â”‚  â”‚      distance_score = max(0, 100 - (distance * 20))          â”‚  â”‚
    â”‚  â”‚      score += distance_score * 0.4                            â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Rating - 20% weight                                    â”‚  â”‚
    â”‚  â”‚      rating_score = partner.rating * 20  # 5.0 â†’ 100         â”‚  â”‚
    â”‚  â”‚      score += rating_score * 0.2                              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Workload (fewer orders = better) - 20% weight          â”‚  â”‚
    â”‚  â”‚      current_orders = get_active_orders(partner.id)           â”‚  â”‚
    â”‚  â”‚      workload_score = (3 - current_orders) * 33               â”‚  â”‚
    â”‚  â”‚      score += workload_score * 0.2                            â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Fairness (longer idle = better) - 10% weight           â”‚  â”‚
    â”‚  â”‚      idle_minutes = time_since_last_order(partner.id)         â”‚  â”‚
    â”‚  â”‚      idle_score = min(100, idle_minutes * 2)                  â”‚  â”‚
    â”‚  â”‚      score += idle_score * 0.1                                â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Acceptance rate - 10% weight                           â”‚  â”‚
    â”‚  â”‚      acceptance_score = partner.acceptance_rate              â”‚  â”‚
    â”‚  â”‚      score += acceptance_score * 0.1                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      return score                                              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  STEP 4: SORT AND SELECT TOP PARTNERS                         â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  scored_partners = [                                           â”‚  â”‚
    â”‚  â”‚      (partner, calculate_score(partner, restaurant, order))   â”‚  â”‚
    â”‚  â”‚      for partner in available                                  â”‚  â”‚
    â”‚  â”‚  ]                                                              â”‚  â”‚
    â”‚  â”‚  scored_partners.sort(key=lambda x: x[1], reverse=True)       â”‚  â”‚
    â”‚  â”‚  top_partners = scored_partners[:3]  # Try top 3              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  STEP 5: SEND DELIVERY REQUEST (Sequential)                   â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  for partner, score in top_partners:                          â”‚  â”‚
    â”‚  â”‚      accepted = send_request_and_wait(                        â”‚  â”‚
    â”‚  â”‚          partner_id=partner.id,                               â”‚  â”‚
    â”‚  â”‚          order_id=order.id,                                    â”‚  â”‚
    â”‚  â”‚          timeout=30  # seconds                                â”‚  â”‚
    â”‚  â”‚      )                                                          â”‚  â”‚
    â”‚  â”‚      if accepted:                                              â”‚  â”‚
    â”‚  â”‚          assign_order(order.id, partner.id)                   â”‚  â”‚
    â”‚  â”‚          return partner                                        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  # No one accepted - expand radius and retry                  â”‚  â”‚
    â”‚  â”‚  return retry_with_larger_radius()                            â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 4: ASSIGNMENT FLOW DIAGRAM
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  DELIVERY PARTNER ASSIGNMENT FLOW                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Restaurant Confirms Order                                    â”‚  â”‚
    â”‚  â”‚            â”‚                                                    â”‚  â”‚
    â”‚  â”‚            â–¼                                                    â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
    â”‚  â”‚   â”‚ Order Service   â”‚                                          â”‚  â”‚
    â”‚  â”‚   â”‚ publishes event â”‚                                          â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
    â”‚  â”‚            â”‚                                                    â”‚  â”‚
    â”‚  â”‚            â–¼                                                    â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
    â”‚  â”‚   â”‚     Kafka       â”‚                                          â”‚  â”‚
    â”‚  â”‚   â”‚ order-confirmed â”‚                                          â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
    â”‚  â”‚            â”‚                                                    â”‚  â”‚
    â”‚  â”‚            â–¼                                                    â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
    â”‚  â”‚   â”‚       DELIVERY ASSIGNMENT SERVICE    â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚                                       â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚   1. Query Redis GEO for nearby     â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚   2. Filter by status=ONLINE        â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚   3. Calculate scores               â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚   4. Sort by score DESC             â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚                                       â”‚                     â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
    â”‚  â”‚                  â”‚                                              â”‚  â”‚
    â”‚  â”‚                  â–¼                                              â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
    â”‚  â”‚   â”‚     Send Push Notification          â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚     to Top Partner                  â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚                                       â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚  "New delivery request!"            â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚  Restaurant: Pizza Palace           â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚  Distance: 1.2 km                   â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚  Earnings: â‚¹45                      â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚  [ACCEPT]  [REJECT]                 â”‚                     â”‚  â”‚
    â”‚  â”‚   â”‚                                       â”‚                     â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
    â”‚  â”‚                  â”‚                                              â”‚  â”‚
    â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚  â”‚
    â”‚  â”‚         â”‚                 â”‚                                    â”‚  â”‚
    â”‚  â”‚         â–¼                 â–¼                                    â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚  â”‚
    â”‚  â”‚   â”‚ ACCEPTED â”‚     â”‚ REJECTED â”‚                               â”‚  â”‚
    â”‚  â”‚   â”‚    or    â”‚     â”‚    or    â”‚                               â”‚  â”‚
    â”‚  â”‚   â”‚ TIMEOUT  â”‚     â”‚ TIMEOUT  â”‚                               â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚
    â”‚  â”‚        â”‚                â”‚                                      â”‚  â”‚
    â”‚  â”‚        â–¼                â–¼                                      â”‚  â”‚
    â”‚  â”‚   Assign to         Try next                                  â”‚  â”‚
    â”‚  â”‚   this partner      ranked partner                            â”‚  â”‚
    â”‚  â”‚        â”‚                â”‚                                      â”‚  â”‚
    â”‚  â”‚        â–¼                â”‚                                      â”‚  â”‚
    â”‚  â”‚   Update Order      â—„â”€â”€â”€â”˜                                     â”‚  â”‚
    â”‚  â”‚   Status                                                       â”‚  â”‚
    â”‚  â”‚        â”‚                                                       â”‚  â”‚
    â”‚  â”‚        â–¼                                                       â”‚  â”‚
    â”‚  â”‚   Notify Customer                                             â”‚  â”‚
    â”‚  â”‚   Notify Restaurant                                           â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  HANDLING NO PARTNERS AVAILABLE                                       â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  RETRY STRATEGY:                                               â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Attempt 1: 3 km radius, top 3 partners, 30s timeout          â”‚  â”‚
    â”‚  â”‚  Attempt 2: 5 km radius, top 5 partners, 45s timeout          â”‚  â”‚
    â”‚  â”‚  Attempt 3: 8 km radius, all partners, 60s timeout            â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  If all fail:                                                  â”‚  â”‚
    â”‚  â”‚  â€¢ Notify customer about delay                                â”‚  â”‚
    â”‚  â”‚  â€¢ Add to priority queue                                      â”‚  â”‚
    â”‚  â”‚  â€¢ Retry every 2 minutes                                      â”‚  â”‚
    â”‚  â”‚  â€¢ After 15 mins: offer cancellation with full refund        â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 5: LIVE TRACKING
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  REAL-TIME TRACKING ARCHITECTURE                                       â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚   Delivery Partner App                                         â”‚  â”‚
    â”‚  â”‚         â”‚                                                       â”‚  â”‚
    â”‚  â”‚         â”‚ PUT /api/partner/location                           â”‚  â”‚
    â”‚  â”‚         â”‚ (every 4 seconds)                                   â”‚  â”‚
    â”‚  â”‚         â”‚                                                       â”‚  â”‚
    â”‚  â”‚         â–¼                                                       â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚  â”‚
    â”‚  â”‚   â”‚ LOCATION SERVICE â”‚                                        â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚  â”‚
    â”‚  â”‚            â”‚                                                   â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
    â”‚  â”‚    â”‚       â”‚       â”‚                                          â”‚  â”‚
    â”‚  â”‚    â–¼       â–¼       â–¼                                          â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚  â”‚
    â”‚  â”‚  â”‚Redisâ”‚ â”‚Redisâ”‚ â”‚  Kafka  â”‚                                 â”‚  â”‚
    â”‚  â”‚  â”‚GEO  â”‚ â”‚Hash â”‚ â”‚location â”‚                                 â”‚  â”‚
    â”‚  â”‚  â”‚     â”‚ â”‚     â”‚ â”‚-updates â”‚                                 â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                 â”‚  â”‚
    â”‚  â”‚                       â”‚                                       â”‚  â”‚
    â”‚  â”‚                       â–¼                                       â”‚  â”‚
    â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚  â”‚
    â”‚  â”‚              â”‚   TRACKING     â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚   SERVICE      â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚                â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚ â€¢ Maintain map â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚   of active    â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚   order_id â†’   â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚   ws_connectionâ”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚                â”‚                               â”‚  â”‚
    â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚
    â”‚  â”‚                      â”‚                                        â”‚  â”‚
    â”‚  â”‚                      â”‚ WebSocket push                         â”‚  â”‚
    â”‚  â”‚                      â”‚                                        â”‚  â”‚
    â”‚  â”‚                      â–¼                                        â”‚  â”‚
    â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚  â”‚
    â”‚  â”‚              â”‚  Customer App  â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚                â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚  ğŸ“ Live map   â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚  ETA: 5 mins   â”‚                               â”‚  â”‚
    â”‚  â”‚              â”‚                â”‚                               â”‚  â”‚
    â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  WEBSOCKET CONNECTION MANAGEMENT                                       â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Customer opens tracking screen:                               â”‚  â”‚
    â”‚  â”‚  1. Connect WebSocket: ws://tracking.zomato.com/orders/123    â”‚  â”‚
    â”‚  â”‚  2. Server maps: order_123 â†’ [ws_connection_abc]              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  When location update arrives (via Kafka):                     â”‚  â”‚
    â”‚  â”‚  1. Get order_id for this partner                             â”‚  â”‚
    â”‚  â”‚  2. Look up WebSocket connections for order_id                â”‚  â”‚
    â”‚  â”‚  3. Push location to all connected clients                    â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Message format:                                               â”‚  â”‚
    â”‚  â”‚  {                                                              â”‚  â”‚
    â”‚  â”‚    "type": "location_update",                                 â”‚  â”‚
    â”‚  â”‚    "data": {                                                   â”‚  â”‚
    â”‚  â”‚      "latitude": 12.9716,                                     â”‚  â”‚
    â”‚  â”‚      "longitude": 77.5946,                                    â”‚  â”‚
    â”‚  â”‚      "heading": 45,                                           â”‚  â”‚
    â”‚  â”‚      "speed": 25,                                              â”‚  â”‚
    â”‚  â”‚      "eta_seconds": 300,                                      â”‚  â”‚
    â”‚  â”‚      "timestamp": "2024-01-15T15:30:00Z"                     â”‚  â”‚
    â”‚  â”‚    }                                                           â”‚  â”‚
    â”‚  â”‚  }                                                              â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  SCALING WEBSOCKET CONNECTIONS                                         â”‚
    â”‚                                                                         â”‚
    â”‚  Problem: 500K active orders = 500K WebSocket connections             â”‚
    â”‚  Single server can handle ~50K connections                            â”‚
    â”‚  Need: 10+ tracking servers                                           â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Solution: Consistent Hashing for Connection Routing           â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  order_id â†’ hash â†’ tracking_server_N                   â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  order_123 â†’ hash â†’ Server 3                          â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  order_456 â†’ hash â†’ Server 7                          â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚  Redis pub/sub or Kafka for cross-server messages      â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 6: ETA CALCULATION
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  ETA COMPONENTS                                                        â”‚
    â”‚                                                                         â”‚
    â”‚  Total ETA = Restaurant Prep Time                                      â”‚
    â”‚            + Partner Travel to Restaurant                              â”‚
    â”‚            + Pickup Time (parking, waiting)                           â”‚
    â”‚            + Travel to Customer                                        â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Order Placed                                                  â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â”‚ Restaurant Prep Time                                  â”‚  â”‚
    â”‚  â”‚       â”‚ (15-30 mins based on items)                          â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â–¼                                                        â”‚  â”‚
    â”‚  â”‚  Food Ready â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â”‚ Partner arrives (may be before food ready)           â”‚  â”‚
    â”‚  â”‚       â”‚ (5-10 mins based on distance)                        â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â–¼                                                        â”‚  â”‚
    â”‚  â”‚  Pickup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â”‚ Travel to Customer                                   â”‚  â”‚
    â”‚  â”‚       â”‚ (Google Maps API for route)                          â”‚  â”‚
    â”‚  â”‚       â”‚                                                        â”‚  â”‚
    â”‚  â”‚       â–¼                                                        â”‚  â”‚
    â”‚  â”‚  Delivered â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  ETA CALCULATION ALGORITHM                                            â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  def calculate_eta(order, partner, restaurant, customer):     â”‚  â”‚
    â”‚  â”‚      # 1. Restaurant prep time (from restaurant settings)     â”‚  â”‚
    â”‚  â”‚      prep_time = restaurant.avg_prep_time                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # Adjust based on current load                           â”‚  â”‚
    â”‚  â”‚      active_orders = get_restaurant_active_orders(restaurant) â”‚  â”‚
    â”‚  â”‚      if active_orders > 10:                                   â”‚  â”‚
    â”‚  â”‚          prep_time += (active_orders - 10) * 2  # +2 min eachâ”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # 2. Partner to restaurant                               â”‚  â”‚
    â”‚  â”‚      partner_to_rest = google_maps.get_duration(             â”‚  â”‚
    â”‚  â”‚          origin=partner.location,                             â”‚  â”‚
    â”‚  â”‚          destination=restaurant.location,                     â”‚  â”‚
    â”‚  â”‚          traffic=True                                         â”‚  â”‚
    â”‚  â”‚      )                                                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # 3. Pickup buffer                                       â”‚  â”‚
    â”‚  â”‚      pickup_buffer = 3  # minutes for parking, finding, etc. â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # 4. Restaurant to customer                              â”‚  â”‚
    â”‚  â”‚      rest_to_customer = google_maps.get_duration(            â”‚  â”‚
    â”‚  â”‚          origin=restaurant.location,                          â”‚  â”‚
    â”‚  â”‚          destination=customer.location,                       â”‚  â”‚
    â”‚  â”‚          traffic=True                                         â”‚  â”‚
    â”‚  â”‚      )                                                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # 5. Calculate parallel time                             â”‚  â”‚
    â”‚  â”‚      # Partner travels WHILE food is being prepared          â”‚  â”‚
    â”‚  â”‚      wait_time = max(0, prep_time - partner_to_rest)         â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      total_eta = (                                            â”‚  â”‚
    â”‚  â”‚          partner_to_rest +                                    â”‚  â”‚
    â”‚  â”‚          wait_time +                                          â”‚  â”‚
    â”‚  â”‚          pickup_buffer +                                      â”‚  â”‚
    â”‚  â”‚          rest_to_customer                                     â”‚  â”‚
    â”‚  â”‚      )                                                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      # 6. Add buffer for uncertainty                          â”‚  â”‚
    â”‚  â”‚      total_eta *= 1.1  # 10% buffer                          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚      return round(total_eta)                                  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  DYNAMIC ETA UPDATES                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  ETA is recalculated at each stage:                                   â”‚
    â”‚  â€¢ When partner assigned                                              â”‚
    â”‚  â€¢ When partner reaches restaurant                                    â”‚
    â”‚  â€¢ When food picked up                                                â”‚
    â”‚  â€¢ Every 30 seconds during delivery                                  â”‚
    â”‚  â€¢ When traffic conditions change significantly                      â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
END OF PART 3
================================================================================

