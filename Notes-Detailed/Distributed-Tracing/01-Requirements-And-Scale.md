================================================================================
DISTRIBUTED TRACING SYSTEM DESIGN (JAEGER-LIKE)
================================================================================

CHAPTER 1: REQUIREMENTS AND SCALE ESTIMATION
================================================================================

TABLE OF CONTENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Problem Statement
2. Functional Requirements
3. Non-Functional Requirements
4. Scale Estimation
5. Core Concepts


================================================================================
SECTION 1.1: PROBLEM STATEMENT
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  WHY DISTRIBUTED TRACING?                                              â”‚
    â”‚                                                                         â”‚
    â”‚  In a microservices architecture:                                      â”‚
    â”‚  â€¢ Single request â†’ touches 10-100+ services                          â”‚
    â”‚  â€¢ Each service has its own logs                                       â”‚
    â”‚  â€¢ Debugging is like finding a needle in a haystack                   â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  THE PROBLEM                                                           â”‚
    â”‚                                                                         â”‚
    â”‚  User reports: "My order failed"                                       â”‚
    â”‚                                                                         â”‚
    â”‚  Without tracing:                                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Request â†’ API Gateway â†’ Order Service â†’ Payment Service       â”‚  â”‚
    â”‚  â”‚              â”‚               â”‚                â”‚                 â”‚  â”‚
    â”‚  â”‚              â”‚               â”‚                â””â”€â”€ Error here?   â”‚  â”‚
    â”‚  â”‚              â”‚               â””â”€â”€ Or here?                       â”‚  â”‚
    â”‚  â”‚              â””â”€â”€ Maybe here?                                    â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Each service logs independently:                              â”‚  â”‚
    â”‚  â”‚  â€¢ Different timestamps                                        â”‚  â”‚
    â”‚  â”‚  â€¢ Different request IDs (or none!)                           â”‚  â”‚
    â”‚  â”‚  â€¢ Different log formats                                       â”‚  â”‚
    â”‚  â”‚  â€¢ No causal relationship                                      â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  DEBUGGING: Search each service's logs manually ğŸ˜°             â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  With distributed tracing:                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  Trace ID: abc123                                              â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
    â”‚  â”‚  â”‚ API Gateway [span-1]                                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â”œâ”€â”€ Order Service [span-2]                              â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â”‚   â”œâ”€â”€ Inventory Check [span-3]    âœ“ 45ms             â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â”‚   â”œâ”€â”€ Payment Service [span-4]   âœ— ERROR - Timeout  â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â”‚   â”‚   â””â”€â”€ Stripe API [span-5]    âœ— 30s timeout       â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â”‚   â””â”€â”€ (cancelled)                                     â”‚  â”‚  â”‚
    â”‚  â”‚  â”‚ â””â”€â”€ 502 Bad Gateway                                      â”‚  â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  DEBUGGING: Single view shows entire request flow ğŸ¯          â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 1.2: FUNCTIONAL REQUIREMENTS
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  CORE FUNCTIONAL REQUIREMENTS                                          â”‚
    â”‚                                                                         â”‚
    â”‚  1. TRACE COLLECTION                                                   â”‚
    â”‚     â€¢ Collect spans from all services                                 â”‚
    â”‚     â€¢ Support multiple languages (Java, Go, Python, Node.js, etc.)   â”‚
    â”‚     â€¢ Context propagation across service boundaries                   â”‚
    â”‚     â€¢ Support various transports (HTTP, gRPC, Kafka, etc.)           â”‚
    â”‚                                                                         â”‚
    â”‚  2. TRACE STORAGE                                                      â”‚
    â”‚     â€¢ Store traces durably                                            â”‚
    â”‚     â€¢ Support configurable retention (7 days, 30 days, etc.)        â”‚
    â”‚     â€¢ Handle high write throughput                                    â”‚
    â”‚                                                                         â”‚
    â”‚  3. TRACE QUERY & SEARCH                                              â”‚
    â”‚     â€¢ Find traces by trace ID                                        â”‚
    â”‚     â€¢ Search by service name                                          â”‚
    â”‚     â€¢ Search by operation name                                        â”‚
    â”‚     â€¢ Search by tags (user_id, order_id, error=true)                â”‚
    â”‚     â€¢ Search by time range                                            â”‚
    â”‚     â€¢ Search by duration (find slow requests)                        â”‚
    â”‚                                                                         â”‚
    â”‚  4. TRACE VISUALIZATION                                               â”‚
    â”‚     â€¢ Display trace timeline (waterfall/Gantt view)                  â”‚
    â”‚     â€¢ Show span hierarchy (parent-child relationships)               â”‚
    â”‚     â€¢ Display span details (tags, logs, errors)                      â”‚
    â”‚     â€¢ Service dependency graph                                        â”‚
    â”‚                                                                         â”‚
    â”‚  5. SAMPLING                                                           â”‚
    â”‚     â€¢ Configurable sampling rates                                     â”‚
    â”‚     â€¢ Support different sampling strategies                          â”‚
    â”‚     â€¢ 100% capture of errors/slow requests                           â”‚
    â”‚                                                                         â”‚
    â”‚  6. ALERTING (Advanced)                                               â”‚
    â”‚     â€¢ Alert on error rate spikes                                      â”‚
    â”‚     â€¢ Alert on latency anomalies                                      â”‚
    â”‚     â€¢ Integration with alerting systems                               â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 1.3: NON-FUNCTIONAL REQUIREMENTS
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  NON-FUNCTIONAL REQUIREMENTS                                           â”‚
    â”‚                                                                         â”‚
    â”‚  1. LOW OVERHEAD                                                       â”‚
    â”‚     â€¢ < 1% CPU overhead on instrumented services                     â”‚
    â”‚     â€¢ < 5% latency overhead per request                              â”‚
    â”‚     â€¢ Minimal memory footprint                                        â”‚
    â”‚                                                                         â”‚
    â”‚  2. HIGH AVAILABILITY                                                  â”‚
    â”‚     â€¢ Tracing system failure should NOT impact applications          â”‚
    â”‚     â€¢ Fire-and-forget span submission                                â”‚
    â”‚     â€¢ 99.9% availability for query service                          â”‚
    â”‚                                                                         â”‚
    â”‚  3. SCALABILITY                                                        â”‚
    â”‚     â€¢ Handle millions of spans per second                            â”‚
    â”‚     â€¢ Scale storage horizontally                                      â”‚
    â”‚     â€¢ Support thousands of services                                  â”‚
    â”‚                                                                         â”‚
    â”‚  4. LOW LATENCY                                                        â”‚
    â”‚     â€¢ Spans visible within seconds of generation                     â”‚
    â”‚     â€¢ Query response time < 3 seconds                                â”‚
    â”‚                                                                         â”‚
    â”‚  5. DATA INTEGRITY                                                     â”‚
    â”‚     â€¢ No data loss for sampled traces                                â”‚
    â”‚     â€¢ Maintain span relationships correctly                          â”‚
    â”‚                                                                         â”‚
    â”‚  6. SECURITY                                                           â”‚
    â”‚     â€¢ Mask/redact sensitive data in spans                           â”‚
    â”‚     â€¢ Access control for trace data                                  â”‚
    â”‚     â€¢ Audit logging                                                   â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 1.4: SCALE ESTIMATION
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  ASSUMPTIONS (Large-scale system)                                      â”‚
    â”‚                                                                         â”‚
    â”‚  â€¢ 500 microservices                                                  â”‚
    â”‚  â€¢ 100,000 requests per second (peak)                                â”‚
    â”‚  â€¢ Average 20 spans per trace (request touches 20 services)         â”‚
    â”‚  â€¢ 10% sampling rate (production)                                     â”‚
    â”‚  â€¢ 7 days retention                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  SPAN GENERATION RATE                                                  â”‚
    â”‚                                                                         â”‚
    â”‚  Total spans generated:                                               â”‚
    â”‚  100,000 req/s Ã— 20 spans/req = 2,000,000 spans/second              â”‚
    â”‚                                                                         â”‚
    â”‚  After 10% sampling:                                                   â”‚
    â”‚  2,000,000 Ã— 0.1 = 200,000 spans/second                              â”‚
    â”‚                                                                         â”‚
    â”‚  Per day:                                                              â”‚
    â”‚  200,000 Ã— 86,400 = 17.28 billion spans/day                          â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  STORAGE ESTIMATION                                                    â”‚
    â”‚                                                                         â”‚
    â”‚  Average span size (uncompressed):                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  trace_id:        16 bytes (128-bit)                           â”‚  â”‚
    â”‚  â”‚  span_id:         8 bytes (64-bit)                             â”‚  â”‚
    â”‚  â”‚  parent_span_id:  8 bytes                                       â”‚  â”‚
    â”‚  â”‚  operation_name:  50 bytes (avg)                               â”‚  â”‚
    â”‚  â”‚  service_name:    30 bytes (avg)                               â”‚  â”‚
    â”‚  â”‚  start_time:      8 bytes                                       â”‚  â”‚
    â”‚  â”‚  duration:        8 bytes                                       â”‚  â”‚
    â”‚  â”‚  tags:            200 bytes (avg, 10 tags)                     â”‚  â”‚
    â”‚  â”‚  logs:            100 bytes (avg)                              â”‚  â”‚
    â”‚  â”‚  process_info:    100 bytes                                    â”‚  â”‚
    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚  â”‚
    â”‚  â”‚  Total:           ~500 bytes per span                          â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  Daily storage (uncompressed):                                        â”‚
    â”‚  17.28B spans Ã— 500 bytes = 8.64 TB/day                              â”‚
    â”‚                                                                         â”‚
    â”‚  With compression (5:1 ratio):                                        â”‚
    â”‚  8.64 TB / 5 = 1.73 TB/day                                           â”‚
    â”‚                                                                         â”‚
    â”‚  7-day retention:                                                      â”‚
    â”‚  1.73 TB Ã— 7 = ~12 TB total storage                                  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  WRITE THROUGHPUT                                                      â”‚
    â”‚                                                                         â”‚
    â”‚  200,000 spans/second Ã— 500 bytes = 100 MB/second writes            â”‚
    â”‚                                                                         â”‚
    â”‚  This requires:                                                        â”‚
    â”‚  â€¢ Multiple collector instances                                       â”‚
    â”‚  â€¢ Distributed storage (Cassandra/Elasticsearch)                     â”‚
    â”‚  â€¢ Async batched writes                                              â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  NETWORK BANDWIDTH                                                     â”‚
    â”‚                                                                         â”‚
    â”‚  Spans from services â†’ Collectors:                                    â”‚
    â”‚  200,000 spans/s Ã— 500 bytes = 100 MB/s                              â”‚
    â”‚                                                                         â”‚
    â”‚  With protocol overhead and retries: ~150 MB/s                       â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  QUERY LOAD                                                            â”‚
    â”‚                                                                         â”‚
    â”‚  Assumptions:                                                          â”‚
    â”‚  â€¢ 100 developers/SREs actively debugging                            â”‚
    â”‚  â€¢ 10 queries/minute per person on average                           â”‚
    â”‚  â€¢ 1000 queries/minute = ~17 queries/second                          â”‚
    â”‚                                                                         â”‚
    â”‚  Query types:                                                          â”‚
    â”‚  â€¢ Trace by ID: Fast (direct lookup)                                 â”‚
    â”‚  â€¢ Search by tags: More expensive (index scan)                       â”‚
    â”‚  â€¢ Service graphs: Expensive (aggregation)                           â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
SECTION 1.5: CORE CONCEPTS
================================================================================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  OPENTRACING / OPENTELEMETRY CONCEPTS                                 â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  TRACE                                                                 â”‚
    â”‚  â”€â”€â”€â”€â”€â”€                                                                â”‚
    â”‚  A trace represents the entire journey of a request through the       â”‚
    â”‚  distributed system. It's a DAG (Directed Acyclic Graph) of spans.   â”‚
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  Trace ID: 1a2b3c4d5e6f7890                                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  [Span A: HTTP GET /orders]                                    â”‚  â”‚
    â”‚  â”‚      â”‚                                                          â”‚  â”‚
    â”‚  â”‚      â”œâ”€â”€ [Span B: Query Orders DB]                             â”‚  â”‚
    â”‚  â”‚      â”‚                                                          â”‚  â”‚
    â”‚  â”‚      â””â”€â”€ [Span C: Call Payment Service]                        â”‚  â”‚
    â”‚  â”‚              â”‚                                                  â”‚  â”‚
    â”‚  â”‚              â””â”€â”€ [Span D: Call Stripe API]                     â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  SPAN                                                                  â”‚
    â”‚  â”€â”€â”€â”€â”€                                                                 â”‚
    â”‚  A span represents a single unit of work within a trace.             â”‚
    â”‚  Has a start time and duration.                                       â”‚
    â”‚                                                                         â”‚
    â”‚  SPAN STRUCTURE:                                                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  {                                                              â”‚  â”‚
    â”‚  â”‚    "traceId": "1a2b3c4d5e6f7890",                             â”‚  â”‚
    â”‚  â”‚    "spanId": "abc123",                                         â”‚  â”‚
    â”‚  â”‚    "parentSpanId": "parent456",     // null for root span     â”‚  â”‚
    â”‚  â”‚    "operationName": "HTTP GET /api/orders",                   â”‚  â”‚
    â”‚  â”‚    "serviceName": "order-service",                            â”‚  â”‚
    â”‚  â”‚    "startTime": 1640000000000000,   // microseconds           â”‚  â”‚
    â”‚  â”‚    "duration": 45000,               // microseconds (45ms)    â”‚  â”‚
    â”‚  â”‚    "tags": {                                                   â”‚  â”‚
    â”‚  â”‚      "http.method": "GET",                                    â”‚  â”‚
    â”‚  â”‚      "http.url": "/api/orders/123",                          â”‚  â”‚
    â”‚  â”‚      "http.status_code": 200,                                 â”‚  â”‚
    â”‚  â”‚      "user.id": "user_789",                                   â”‚  â”‚
    â”‚  â”‚      "error": false                                           â”‚  â”‚
    â”‚  â”‚    },                                                          â”‚  â”‚
    â”‚  â”‚    "logs": [                                                   â”‚  â”‚
    â”‚  â”‚      {                                                         â”‚  â”‚
    â”‚  â”‚        "timestamp": 1640000000010000,                        â”‚  â”‚
    â”‚  â”‚        "fields": {"event": "cache_miss", "key": "order:123"} â”‚  â”‚
    â”‚  â”‚      }                                                         â”‚  â”‚
    â”‚  â”‚    ],                                                          â”‚  â”‚
    â”‚  â”‚    "process": {                                                â”‚  â”‚
    â”‚  â”‚      "serviceName": "order-service",                         â”‚  â”‚
    â”‚  â”‚      "tags": {"hostname": "order-pod-abc", "ip": "10.0.1.5"} â”‚  â”‚
    â”‚  â”‚    }                                                           â”‚  â”‚
    â”‚  â”‚  }                                                              â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  SPAN RELATIONSHIPS                                                    â”‚
    â”‚                                                                         â”‚
    â”‚  1. CHILD_OF (most common)                                            â”‚
    â”‚     Parent waits for child to complete                                â”‚
    â”‚     Example: HTTP handler â†’ Database query                           â”‚
    â”‚                                                                         â”‚
    â”‚  2. FOLLOWS_FROM                                                       â”‚
    â”‚     Parent does not wait (async)                                      â”‚
    â”‚     Example: Request â†’ Queue message â†’ Async processor               â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  CONTEXT PROPAGATION                                                   â”‚
    â”‚                                                                         â”‚
    â”‚  How trace context flows between services:                            â”‚
    â”‚                                                                         â”‚
    â”‚  HTTP HEADERS (W3C Trace Context):                                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  traceparent: 00-{trace-id}-{parent-span-id}-{flags}          â”‚  â”‚
    â”‚  â”‚  traceparent: 00-0af7651916cd43dd8448eb211c80319c-b7ad6b...   â”‚  â”‚
    â”‚  â”‚                                                                 â”‚  â”‚
    â”‚  â”‚  tracestate: vendor1=value1,vendor2=value2                     â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  JAEGER FORMAT (B3):                                                   â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  uber-trace-id: {trace-id}:{span-id}:{parent-id}:{flags}      â”‚  â”‚
    â”‚  â”‚  uber-trace-id: 1a2b3c:abc123:parent456:1                     â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                         â”‚
    â”‚  gRPC: Passed via metadata                                            â”‚
    â”‚  Kafka: Passed via message headers                                    â”‚
    â”‚                                                                         â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
    â”‚                                                                         â”‚
    â”‚  BAGGAGE                                                               â”‚
    â”‚                                                                         â”‚
    â”‚  Key-value pairs that propagate across ALL spans in a trace.         â”‚
    â”‚  Use sparingly (adds overhead).                                       â”‚
    â”‚                                                                         â”‚
    â”‚  Example: user_id, tenant_id, experiment_id                          â”‚
    â”‚  Propagates automatically without manual passing.                     â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


COMPARISON WITH SIMILAR SYSTEMS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ System         â”‚ Origin      â”‚ Storage        â”‚ Unique Features  â”‚ â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
    â”‚  â”‚ Jaeger         â”‚ Uber        â”‚ Cassandra/ES   â”‚ CNCF graduated   â”‚ â”‚
    â”‚  â”‚ Zipkin         â”‚ Twitter     â”‚ Cassandra/ES   â”‚ Simpler, mature  â”‚ â”‚
    â”‚  â”‚ AWS X-Ray      â”‚ AWS         â”‚ Managed        â”‚ AWS integration  â”‚ â”‚
    â”‚  â”‚ Google Trace   â”‚ Google      â”‚ Managed        â”‚ GCP integration  â”‚ â”‚
    â”‚  â”‚ Datadog APM    â”‚ Datadog     â”‚ Managed        â”‚ Full observabilityâ”‚ â”‚
    â”‚  â”‚ Tempo          â”‚ Grafana     â”‚ Object storage â”‚ Cost-effective   â”‚ â”‚
    â”‚  â”‚ Lightstep      â”‚ Lightstep   â”‚ Managed        â”‚ Service mesh     â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
END OF CHAPTER 1
================================================================================

